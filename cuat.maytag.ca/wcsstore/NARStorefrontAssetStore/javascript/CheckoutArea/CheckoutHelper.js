dojo.require("dojox.collections.ArrayList");dojo.require("wc.widget.Tooltip");CheckoutHelperJS={langId:"-1",storeId:"",catalogId:"",orderId:"",shipmentTypeId:"",orderItemIds:[],updateWaitTimeOut:1500,keyPressCount:{},ajaxCheckOut:true,singlePageCheckout:true,selectedAddressesArray:{},dataDirty:{},fieldDirtyFlag:false,resetRequestedShipDateValue:"1970-01-01T00:00:00.000Z",shoppingCartPage:false,pendingOrderDetailsPage:false,RequestShippingDateAction:false,giftMessageMaxLength:180,shipChargeEnabled:false,tempOrderId:"",tempPaymentType:"",tempUserType:"",tempEmailAddresses:"",tempIsQuote:false,orderPrepared:"false",setOrderPrepared:function(inPrepareIndicator){this.orderPrepared=inPrepareIndicator;},isOrderPrepared:function(){return this.orderPrepared;},saveCheckoutOrderParameters:function(orderId,paymentType,userType,addressListForMailNotification,isQuote){this.tempOrderId=orderId;this.tempPaymentType=paymentType;this.tempUserType=userType;this.tempEmailAddresses=addressListForMailNotification;this.tempIsQuote=isQuote;},getSavedParameter:function(paramName){return this[paramName];},setShipChargeEnabled:function(enabled){this.shipChargeEnabled=enabled;},updateParamObject:function(params,key,value,toArray,index){if(params==null){params=[];}if(params[key]!=null&&toArray){if(dojo.lang.isArrayLike(params[key])){if(index!=null&&index!=""){params[key][index]=value;}else{params[key].push(value);}}else{var tmpValue=params[key];params[key]=[];params[key].push(tmpValue);params[key].push(value);}}else{if(index!=null&&index!=""&&index!=-1){params[key+"_"+index]=value;}else{if(index==-1){var i=1;while(params[key+"_"+i]!=null){i++;}params[key+"_"+i]=value;}else{params[key]=value;}}}return params;},checkRequestShippingDateBox:function(checkBoxName,divName,suffix){var thisCheckBoxName;var thisDivName;if(suffix!=null&&suffix!=""){checkBoxName=checkBoxName+"_"+suffix;divName=divName+"_"+suffix;}var checkBox=dojo.byId(checkBoxName);var addressId,shipModeId="";if(this.shipmentTypeId=="1"){addressId=document.getElementById("singleShipmentAddress").value;shipModeId=document.getElementById("singleShipmentShippingMode").value;}else{if(this.shipmentTypeId=="2"){addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value;shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value;}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}if(checkBox.checked){dojo.byId(divName).style.visibility="visible";dojo.byId(divName).style.display="block";}else{dojo.byId(divName).style.visibility="hidden";dojo.byId(divName).style.display="none";}if(!checkBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);if(dijit.byId("requestedShippingDate")!=null||dijit.byId("MS_requestedShippingDate_"+suffix)!=null){this.updateParamObject(params,"requestedShipDate",this.resetRequestedShipDateValue,false,-1);}var orderItemId=null;var qty=null;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){qty=document.getElementById("qty_"+(i+1)).value;orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(qty!=-1){if(this.shipmentTypeId=="1"){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);break;}else{if(this.shipmentTypeId=="2"){if(suffix!=null&&suffix!=""&&orderItemId==suffix){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);break;}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}}}if(!submitRequest()){return;}cursor_wait();CheckoutHelperJS.RequestShippingDateAction=true;wc.service.invoke("OrderItemAddressShipMethodUpdate",params);}},updateGiftMessageForThisOrder:function(){if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;var giftMessageTo=document.getElementById("MS_giftMessageTo").value;var giftMessageFrom=document.getElementById("MS_giftMessageFrom").value;var giftMessage=document.getElementById("MS_giftMessage").value;if(giftMessage.length<=this.giftMessageMaxLength){giftMessage="TO:"+giftMessageTo+" FROM:"+giftMessageFrom+" MESSAGE:"+giftMessage;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(giftMessage)){giftMessage="";}this.updateParamObject(params,"field3",giftMessage,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);}},checkShippingInstructionsBox:function(checkBoxName,divName,suffix){var thisCheckBoxName;var thisDivName;if(suffix!=null&&suffix!=""){thisCheckBoxName=checkBoxName+"_"+suffix;thisDivName=divName+"_"+suffix;}else{thisCheckBoxName=checkBoxName;thisDivName=divName;}var thisCheckBox=dojo.byId(thisCheckBoxName);if(thisCheckBox.checked){dojo.byId(thisDivName).style.visibility="visible";dojo.byId(thisDivName).style.display="block";}else{dojo.byId(thisDivName).style.visibility="hidden";dojo.byId(thisDivName).style.display="none";}var addressId,shipModeId="";if(this.shipmentTypeId=="1"){addressId=document.getElementById("singleShipmentAddress").value;shipModeId=document.getElementById("singleShipmentShippingMode").value;}else{if(this.shipmentTypeId=="2"){var orderItemId,tempAddressId,tempShipModeId="";addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value;shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){orderItemId=document.getElementById("orderItem_"+(i+1)).value;tempAddressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;tempShipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;if(tempShipModeId==shipModeId&&tempAddressId==addressId){var tempDivName=divName+"_"+orderItemId;var tempCheckBoxName=checkBoxName+"_"+orderItemId;if(thisCheckBox.checked){dojo.byId(tempDivName).style.visibility="visible";dojo.byId(tempDivName).style.display="block";dojo.byId(tempCheckBoxName).checked="checked";}else{dojo.byId(tempDivName).style.visibility="hidden";dojo.byId(tempDivName).style.display="none";dojo.byId(tempCheckBoxName).checked="";}}}}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}if(!thisCheckBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;if(this.shipmentTypeId=="1"){if(document.getElementById("shipInstructions")!=null){this.updateParamObject(params,"shipInstructions","",false);document.getElementById("shipInstructions").value="";}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"addressId",addressId,false);this.updateParamObject(params,"orderItemId",orderItemId,false);}else{if(this.shipmentTypeId=="2"){if(suffix!=null&&suffix!=""){if(document.getElementById("MS_shipInstructions_"+suffix)!=null){this.updateParamObject(params,"shipInstructions","",false);document.getElementById("MS_shipInstructions_"+suffix).value="";}this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"orderItemId",suffix,false);this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,"");}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);}},initializeShipmentPage:function(shipmentTypeId){this.shipmentTypeId=shipmentTypeId;},setCommonParameters:function(langId,storeId,catalogId){this.langId=langId;this.storeId=storeId;this.catalogId=catalogId;},deleteRoomFromCart:function(roomGroupId){if(!this.isAjaxCheckOut()){return;}var params=[];$(".roomGroup_"+roomGroupId).each(function(index,object){params["orderItemId_"+index]=$(this).val();});params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=(this.orderId!=null&&this.orderId!="undefined"&&this.orderId!="")?this.orderId:".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.roomGroupId=roomGroupId;params.invCheck="false";params.updateESPQuantity="true";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxDeleteOrderItem",params);},deleteFromCart:function(orderItemId,forWishlist){if(!this.isAjaxCheckOut()){return;}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=(this.orderId!=null&&this.orderId!="undefined"&&this.orderId!="")?this.orderId:".";params.orderItemId=orderItemId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.invCheck="false";params.updateESPQuantity="true";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}var x=document.getElementById("totalNumberOfItems").value;var y=x;for(var i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));if(qtyObj!=null||qtyObj!=undefined){qty=qtyObj.value;if(qty!=null&&qty!=undefined&&qty==-1){y=y-1;}}}if(!submitRequest()){return;}cursor_wait();if(y==1){wc.service.invoke("AjaxDeleteOrderItem1",params);}else{if(forWishlist){wc.service.invoke("AjaxDeleteOrderItemFromCart",params);}else{if(this.shoppingCartPage||this.pendingOrderDetailsPage){wc.service.invoke("AjaxDeleteOrderItem",params);}else{wc.service.invoke("AjaxDeleteOrderItemForShippingBillingPage",params);}}}},addBundleToWishListAndDeleteFromCart:function(bundleId,roomGroupId){if(!this.isAjaxCheckOut()){return;}var params=[];params.URL="SuccessfulAJAXRequest";params.bundleId=bundleId;params.roomGroupId=roomGroupId;params.updateable=0;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxInterestItemAddAndDeleteFromCart",params);},addToWishListAndDeleteFromCart:function(catEntryIdentifier,orderItemId,quantity){if(!this.isAjaxCheckOut()){return;}var params=[];params.catEntryId=catEntryIdentifier;params.URL="SuccessfulAJAXRequest";params.orderItemId=orderItemId;if(quantity!=null&&quantity!="undefined"){params.quantity=quantity;}else{params.quantity=1;}params.updateable=0;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxInterestItemAddAndDeleteFromCart",params);},Add2WishListAjaxByID:function(catalogEntryId){if(catalogEntryId!=null){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.catEntryId=catalogEntryId;params.updateable=0;params.URL="SuccessfulAJAXRequest";if(document.getElementById("controllerURLWishlist")!=null&&document.getElementById("controllerURLWishlist")!="undefined"){CommonControllersDeclarationJS.setControllerURL("ShopCartDisplayController",document.getElementById("controllerURLWishlist").value);}if(!submitRequest()){return;}cursor_wait();if(this.ajaxShopCart){wc.service.invoke("AjaxInterestItemAdd",params);}else{wc.service.invoke("AjaxInterestItemAdd_shopCart",params);}}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERR_RESOLVING_SKU);}},updateAddressIdOFItemsOnCreateEditAddress:function(addressId){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var orderItemId=null;for(var i=0;i<this.orderItemIds.length;i++){orderItemId=this.orderItemIds[i];this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItemsAddressId",params);},updateAddressIdOfAddressInDropdown:function(addressBox,oldAddressId,newAddressId){if(!addressBox){return;}for(var i=0;i<addressBox.options.length;i++){if(addressBox.options[i].value==oldAddressId){addressBox.options[i].value=newAddressId;break;}}},saveOrderItemsList:function(orderItemId,addressId){if(orderItemId=="-1"){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(!document.getElementById("freeGift_qty_"+(i+1))){this.orderItemIds[i]=document.getElementById("orderItem_"+(i+1)).value;}}}else{if(orderItemId==0&&this.shipmentTypeId=="1"){if(document.getElementById("singleShipmentAddress")){if(addressId==document.getElementById("singleShipmentAddress").value){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(!document.getElementById("freeGift_qty_"+(i+1))){this.orderItemIds[i]=document.getElementById("orderItem_"+(i+1)).value;}}}else{this.orderItemIds=[];}}else{this.orderItemIds=[];}return;}else{var totalItems=document.getElementById("totalNumberOfItems").value;var temp=null;var orderItemId=null;var j=0;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(!document.getElementById("freeGift_qty_"+(i+1))){if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){temp=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(temp==addressId){this.orderItemIds[j++]=orderItemId;}}}}}}},setShippingInstuctionsForAllOtherItems:function(addressId,shipModeId,shipInstructions){var orderItemId,addressId1,shipModeId1="";var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){orderItemId=document.getElementById("orderItem_"+(i+1)).value;addressId1=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;shipModeId1=document.getElementById("MS_ShippingMode_"+orderItemId).value;if(shipModeId1==shipModeId&&addressId1==addressId){document.getElementById("MS_shipInstructions_"+orderItemId).value=shipInstructions;}}}},shipAsComplete:function(checkBox){if(!this.isAjaxCheckOut()){return;}var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(checkBox.checked){this.updateParamObject(params,"ShipAsComplete","Y",true);}else{this.updateParamObject(params,"ShipAsComplete","N",true);}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateAddressIdForOrderItem:function(addressId){if(addressId==null||addressId.length==0){return true;}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"addressId",addressId,false);wc.service.invoke("AjaxSetAddressIdOfOrderItems",params);},updateShipModeIdForOrder:function(shipModeId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.shipModeId=shipModeId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";wc.service.invoke("AjaxSetShipModeIdForOrder",params);},applyPromotionCode:function(formName,returnView,isUpper){var form=document.forms[formName];if(isUpper=="true"){form.promoCode.value=form.promoCode.value.toUpperCase();}if(trim(form.promoCode.value)==""){MessageHelper.formErrorHandleClient(form.promoCode.id,MessageHelper.messages.PROMOTION_CODE_EMPTY);return;}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(form.URL!=null){form.URL.value="";}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage");}else{if(returnView==null||returnView==""||returnView=="undefined"){returnView="OrderShippingBillingView";}var input=document.createElement("INPUT");input.setAttribute("type","hidden");input.setAttribute("name","errorViewName");input.setAttribute("value",returnView);form.appendChild(input);form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;if(!submitRequest()){return;}form.submit();}},removePromotionCode:function(formName,promoCode,returnView){var form=document.forms[formName];form.taskType.value="R";form.promoCode.value=promoCode;if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage");}else{if(returnView==null||returnView==""||returnView=="undefined"){returnView="OrderShippingBillingView";}form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;if(!submitRequest()){return;}form.submit();}},applyCoupon:function(formName,returnView,couponId){var form=document.forms[formName];form.couponId.value=couponId;form.taskType.value="A";if(!submitRequest()){return;}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxCouponsAddRemove");service.formId=formName;cursor_wait();wc.service.invoke("AjaxCouponsAddRemove");}else{form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;form.submit();}},removeCouponFromOrder:function(formName,returnView,couponId){var form=document.forms[formName];form.couponId.value=couponId;form.taskType.value="R";if(!submitRequest()){return;}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxCouponsAddRemove");service.formId=formName;cursor_wait();wc.service.invoke("AjaxCouponsAddRemove");}else{form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;form.submit();}},setAjaxCheckOut:function(ajaxCheckOut){this.ajaxCheckOut=ajaxCheckOut;},isAjaxCheckOut:function(){return this.ajaxCheckOut;},setSinglePageCheckout:function(singlePageCheckout){this.singlePageCheckout=singlePageCheckout;},isSinglePageCheckout:function(){return this.singlePageCheckout;},checkoutOrder:function(orderId,paymentType,userType,addressListForMailNotification,isQuote){if(isQuote==undefined||isQuote==null){isQuote=false;}if(this.isOrderPrepared()=="false"){this.saveCheckoutOrderParameters(orderId,paymentType,userType,addressListForMailNotification,isQuote);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxPrepareOrderForSubmit");return;}params=[];params.orderId=orderId;params.notifyMerchant=1;params.notifyShopper=1;params.notifyOrderSubmitted=1;params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.payInfoCVV=CheckoutPayments.getCVVFromCookie("PAYINFO_CVV");var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if(purchaseOrderForm.purchaseOrderNumberRequired.value=="true"&&purchaseOrderForm.purchase_order_number.value==""){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);return;}else{if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128)){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);return;}}}params.purchaseorder_id=purchaseOrderNumber;if(userType=="G"){addressListForMailNotification=trim(addressListForMailNotification);var emailList=[];emailList=addressListForMailNotification.split(" ");var uniqueList=[];for(var j=0;j<emailList.length;j++){uniqueList[emailList[j]]=emailList[j];}var totalLength=0;for(i in uniqueList){totalLength=totalLength+1;}var temp="";var k=0;for(i in uniqueList){k=k+1;temp=temp+uniqueList[i];if(k<totalLength){temp=temp+",";}}params.notify_EMailSender_recipient=temp;var smsOrderNotificationCheckbox=document.getElementById("sendMeSMSNotification");if(smsOrderNotificationCheckbox!=null&&smsOrderNotificationCheckbox!="undefined"){if(smsOrderNotificationCheckbox.checked){var mobileCountryCode=document.getElementById("mobileCountryCode");var mobilePhone1=document.getElementById("mobilePhone1");if(mobileCountryCode!=null&&mobileCountryCode!="undefined"&&mobilePhone1!=null&&mobilePhone1!="undefined"){params.SMS=mobileCountryCode.value+mobilePhone1.value;}}}}if(!submitRequest()){return;}cursor_wait();if(paymentType=="PP"){CardinalServicesDeclarationJS.setCheckoutParameters(params,isQuote);wc.service.invoke("AjaxCardinalOrder",params);}else{if(paymentType=="HDFC"){params.paymentType=paymentType;HDFCGatewayServicesDeclarationJS.setCheckoutParameters(params,isQuote);wc.service.invoke("AjaxHDFCCheckout",params);}else{if(!isQuote){wc.service.invoke("AjaxSubmitOrder",params);}else{params.URL="";this.setOrderId(orderId);wc.service.invoke("AjaxSubmitQuote",params);}}}},prepareOrderSchedule:function(){if(document.getElementById("scheduleOrderInputSection")!=null){var scheduleOrderStartDateObj=dijit.byId("ScheduleOrderStartDate");if(!this.validateDate(scheduleOrderStartDateObj,"ScheduleOrderStartDate")){return;}var interval=document.getElementById("ScheduleOrderFrequency").value;var key1="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_strStartDate";var key2="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_interval";if((interval=="undefined")&&(scheduleOrderStartDateObj.value==null)){dojo.cookie(key1,null,{expires:-1});dojo.cookie(key2,null,{expires:-1});}else{var t=dojo.date.stamp.fromISOString(scheduleOrderStartDateObj);var now=new Date();t.setHours(now.getHours(),now.getMinutes(),now.getSeconds(),now.getMilliseconds());t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});dojo.cookie(key1,t);dojo.cookie(key2,interval);}}},scheduleOrder:function(orderId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=orderId;params.strStartDate=dojo.cookie("WC_ScheduleOrder_"+orderId+"_strStartDate");params.interval=dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval");var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if(purchaseOrderForm.purchaseOrderNumberRequired.value=="true"&&purchaseOrderForm.purchase_order_number.value==""){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);return;}else{if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128)){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);return;}}params.purchaseorder_id=purchaseOrderNumber;}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("ScheduleOrder",params);},validateDate:function(dateObj,elementId){var now=new Date();if(dateObj.getValue()!=null&&(dateObj.compare(dateObj.getValue(),now)<0)){var interval=document.getElementById("ScheduleOrderFrequency").value;if(interval==""){if(now.toDateString()==dateObj.getValue().toDateString()){return true;}}if((elementId!=null)&&(document.getElementById(elementId)!=null)){MessageHelper.formErrorHandleClient(document.getElementById(elementId).id,MessageHelper.messages.PAST_DATE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.PAST_DATE_ERROR);}return false;}else{return true;}},createAddress:function(orderItemId,addressType){this.saveOrderItemsList(orderItemId,"-1");if(!submitRequest()){return;}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType});this.showHideDivs("editAddressContents","mainContents");},showHideDivs:function(showArea,hideArea){document.getElementById(hideArea).style.display="none";document.getElementById(showArea).style.display="block";},restorePreviousAddressDetails:function(){var valueRestored=false;if(!this.isAjaxCheckOut()){for(i in this.selectedAddressesArray){if(document.getElementById(i).value==-1){document.getElementById(i).value=this.selectedAddressesArray[i];valueRestored=true;if(this.shipmentTypeId=="1"){this.displayAddressDetails(document.getElementById("singleShipmentAddress").value,"Shipping");}}}}if(this.isAjaxCheckOut()||!valueRestored){if(this.shipmentTypeId=="2"){for(var i=0;i<this.orderItemIds.length;i++){var orderItemId=this.orderItemIds[i];var element=document.getElementById("MS_ShipmentAddress_"+orderItemId);if(element!=null&&element.value==-1){element.value=document.getElementById("addressId_"+orderItemId).value;}}}else{if(this.shipmentTypeId=="1"){var element=document.getElementById("singleShipmentAddress");if(element!=null&&document.getElementById("addressId_all")){element.value=document.getElementById("addressId_all").value;if(!this.isAjaxCheckOut()){this.displayAddressDetails(element.value,"Shipping");}}}}}for(var i=1;i<4;i++){if(document.getElementById("PaymentForm"+i)!=null){var paymentForm=document.getElementById("PaymentForm"+i);if(paymentForm.billing_address_id.value==-1){paymentForm.billing_address_id.value=document.getElementById("selectedAddressId_"+i).value;if(!this.isAjaxCheckOut()){CheckoutPayments.displayBillingAddressDetailsWeb10(paymentForm.billing_address_id,i);}}}}},editAddress:function(addressSelectBoxName,orderItemId,profileshipping,profilebilling){if(categoryDisplayJS.storeFlow=="GGW"){MessageHelper.hideAndClearMessage();}var addressBox=document.getElementById(addressSelectBoxName);this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressSelectBoxName!=null){MessageHelper.formErrorHandleClient(addressSelectBoxName,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}return;}if(!submitRequest()){return;}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value,addressBox:addressBox});this.showHideDivs("editAddressContents","mainContents");},editBillingAddress:function(orderItemId,paymentArea,profileshipping,profilebilling){if(categoryDisplayJS.storeFlow=="GGW"){MessageHelper.hideAndClearMessage();}var form=document.forms["PaymentForm"+paymentArea];var addressBox=form.billing_address_id;this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressBox!=null){MessageHelper.formErrorHandleClient(addressBox,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}return;}if(!submitRequest()){return;}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value,addressBox:addressBox});this.showHideDivs("editAddressContents","mainContents");},cancelEditAddress:function(){this.showHideDivs("mainContents","editAddressContents");this.restorePreviousAddressDetails();},getShipmentTypeId:function(){return this.shipmentTypeId;},paymentDataDirty:function(paymentAreaNumber,flag){this.dataDirty[paymentAreaNumber]=flag;console.debug("Information in payment area "+paymentAreaNumber+" has been modified.");},isPaymentDataDirty:function(paymentAreaNumber){return this.dataDirty[paymentAreaNumber];},displayStoreAddressDetails:function(addressSelectBox){var selectedAddressId=addressSelectBox.value;for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block";}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none";}}},updateStoreAddressForAllItems:function(addressSelectBox){if(!this.isAjaxCheckOut()){return;}var addressId=addressSelectBox.value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var orderItemId=null;var totalItems=document.getElementById("totalNumberOfItems").value;var addressId=document.getElementById("singleShipmentAddress").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"physicalStoreId",addressId,false,-1);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},updateShippingModeAndAddressForOrderItem:function(shippingModeSelectBox,orderItemId,pickUpInStoreShipMode){if(!this.isAjaxCheckOut()){return;}var selectedShippingMode=shippingModeSelectBox.value;if(pickUpInStoreShipMode==selectedShippingMode){document.getElementById("MS_ShipMode_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_StoreAddress_Section_"+orderItemId).className="";}else{document.getElementById("MS_ShipMode_Section_"+orderItemId).className="";document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="";document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="";document.getElementById("MS_StoreAddress_Section_"+orderItemId).className="nodisplay";}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.orderItemId=orderItemId;params.shipModeId=selectedShippingMode;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(pickUpInStoreShipMode==selectedShippingMode){var physicalStoreId=document.getElementById("MS_StoreSelectBox_"+orderItemId).value;params.physicalStoreId=physicalStoreId;}else{if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params.addressId=addressId;}}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},updateStoreAddressForOrderItem:function(storeAddressSelectBox,orderItemId){if(!this.isAjaxCheckOut()){return;}var selectedPickUpStoreId=storeAddressSelectBox.value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.orderItemId=orderItemId;params.physicalStoreId=selectedPickUpStoreId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},setFieldDirtyFlag:function(value){this.fieldDirtyFlag=value;},getFieldDirtyFlag:function(){return this.fieldDirtyFlag;},checkForDirtyFlag:function(){if(this.getFieldDirtyFlag()){if(document.getElementById("ShoppingCart_NonAjaxUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("ShoppingCart_NonAjaxUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST_SHOPPING_CART);return true;}else{if(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST);return true;}else{if(document.getElementById("SingleShipment_NonAjaxShipInfoUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("SingleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST);return true;}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_UPDATE_FIRST);return true;}}}}return false;},showHideCheckoutSMS:function(checkboxElementId,smsElementId){var smsOrderNotificationCheckbox=document.getElementById(checkboxElementId);if(smsOrderNotificationCheckbox!=null&&smsOrderNotificationCheckbox!="undefined"){if(smsOrderNotificationCheckbox.checked){showElementById(smsElementId);}else{hideElementById(smsElementId);}}},getCountryArray:function(){if(document.countries==null){countries=new Array();var theDiv=document.getElementById("countryListSelectionHelper");if(typeof theDiv=="undefined"){return null;}var divJSON=eval("("+theDiv.innerHTML+")");var countriesObject=divJSON.countries;for(var i=0;i<countriesObject.length;i++){var countryObject=countriesObject[i];countries[countryObject.code]=new Object();countries[countryObject.code].name=countryObject.displayName;countries[countryObject.code].countryCallingCode=countryObject.callingCode;if(countryObject.states.length>0){countries[countryObject.code].states=new Object();for(var j=0;j<countryObject.states.length;j++){var state=countryObject.states[j];countries[countryObject.code].states[state.code]=state.displayName;}}}}return countries;},loadCountryCode:function(countryDropDownId,countryCallingCodeId){this.getCountryArray();var countryCode=document.getElementById(countryDropDownId).value;document.getElementById(countryCallingCodeId).value=countries[countryCode].countryCallingCode;},expediteShipping:function(checkBox,inputOrderItemId){if(!this.isAjaxCheckOut()){return;}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;if(checkBox.checked){this.updateParamObject(params,"isExpedited","Y",true);}else{this.updateParamObject(params,"isExpedited","N",true);}if(inputOrderItemId!=null){this.updateParamObject(params,"orderItemId",inputOrderItemId,false);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateCartWait:function(quantityBox,orderItemId,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateCart",quantityBox,orderItemId,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateCart:function(quantityBox,orderItemId,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var quantity=(quantityBox.value);if(categoryDisplayJS.storeFlow=="GGW"&&categoryDisplayJS.previousValue!=""&&categoryDisplayJS.previousValue.slice(0,1)=="B"){if(quantity==null||quantity==""||quantity==0||!isNonNegativeInteger(quantity)){MessageHelper.formErrorHandleClient(quantityBox,MessageHelper.messages.QUANTITY_INPUT_ERROR);quantityBox.value=categoryDisplayJS.previousValue.slice(1);categoryDisplayJS.previousValue="";return;}}if(!isNonNegativeInteger(quantity)){MessageHelper.formErrorHandleClient(quantityBox,MessageHelper.messages.QUANTITY_INPUT_ERROR);if(categoryDisplayJS.storeFlow=="GGW"&&categoryDisplayJS.previousValue!=""){quantityBox.value=categoryDisplayJS.previousValue;categoryDisplayJS.previousValue="";}}else{if(categoryDisplayJS.storeFlow=="GGW"&&$("#Order_"+orderItemId).val()!=null&&$("#Order_"+orderItemId).val()!=""){categoryDisplayJS.setExpandCollaps("Expand_"+$("#Order_"+orderItemId).val());}var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"quantity",quantity,false,-1);params.updateESPQuantity="true";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);}},updateCartBundleWait:function(quantityBox,groupId,previousQty,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[groupId]==null&&isNaN(this.keyPressCount[groupId])){this.keyPressCount[groupId]=0;}this.keyPressCount[groupId]=parseInt(this.keyPressCount[groupId])+1;setTimeout(dojo.hitch(this,"updateCartBundle",quantityBox,groupId,previousQty,this.keyPressCount[groupId]),this.updateWaitTimeOut);},updateCartBundle:function(quantityBox,groupId,previousQty,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[groupId]){return;}var quantity=(quantityBox.value);if(!isNonNegativeInteger(quantity)){MessageHelper.formErrorHandleClient(quantityBox,MessageHelper.messages.QUANTITY_INPUT_ERROR);}else{var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var ordItmIds=document.getElementsByClassName("roomGroup_"+groupId);var i;for(i=0;i<ordItmIds.length;i++){this.updateParamObject(params,"orderItemId",ordItmIds[i].value,false,-1);}var ordItmQty=document.getElementsByClassName("roomGroupQty_"+groupId);for(i=0;i<ordItmQty.length;i++){var qty=(ordItmQty[i].value/previousQty)*quantity;this.updateParamObject(params,"quantity",qty,false,-1);}params.updateESPQuantity="true";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);}},updateServiceOptionsWait:function(additionalSKUElement,orderItemId,skuType,currentSKUs,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}if(skuType!=1&&skuType!=2&&skuType!=3){return;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateServiceOptions",additionalSKUElement,orderItemId,skuType,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateServiceOptions:function(additionalSKUElement,orderItemId,skuType,currentSKUs,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var additionalSKU=(additionalSKUElement.value);var servicesArray=[];servicesArray=currentSKUs.toString().split("_");var newSKUs;if(skuType==1){}else{if(skuType==2){newSKUs=servicesArray[0]+"_"+additionalSKU+"_";}else{newSKUs=servicesArray[0]+"_";if(!isNaN(servicesArray[1])){newSKUs=newSKUs+servicesArray[1];}newSKUs=newSKUs+"_";}}var optSrvIndex=1;var productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);while(productElement!=null){if(productElement!=null){if(productElement.checked){newSKUs=newSKUs+productElement.value+"_";}}else{break;}optSrvIndex++;productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);}var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"comment",newSKUs,false,-1);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},initDojoEventListenerShoppingCartPage:function(){if(document.getElementById("totalNumberOfItems")!=null){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){for(var i=0;i<totalItems;i++){var object=dojo.byId("quantity_"+(i+1));if(object!=null){dojo.connect(object,"onchange",setDirtyFlag);}}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}}},updateShoppingCart:function(form,validateQuantityOnly){if(validateQuantityOnly!=undefined&&validateQuantityOnly==true&&!this.isAjaxCheckOut()){return true;}MessageHelper.hideAndClearMessage();var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null){for(var i=0;i<totalItems;i++){if(form!=undefined){var quantity=null;quantity=form["quantity_"+(i+1)];}else{var quantity=dojo.byId("qty_"+(i+1));}if(quantity!=null||quantity!=undefined){var v=quantity.value;if(!isNonNegativeInteger(v)){MessageHelper.formErrorHandleClient(quantity.id,MessageHelper.messages.QUANTITY_INPUT_ERROR);return;}else{if(v>parseInt(MessageHelper.messages.MAX_ORDERITEM_QTY)){MessageHelper.formErrorHandleClient(quantity.id,MessageHelper.messages.ERR_MAX_ORDERITEM_QTY);return;}}}}if(document.getElementById("MS_giftMessage")){var giftMessage=document.getElementById("MS_giftMessage").value;if(giftMessage.length>this.giftMessageMaxLength){MessageHelper.formErrorHandleClient("MS_giftMessage",MessageHelper.messages.ERROR_MAXIMUM_GIFT_MESSAGE_LENGTH);return;}}if(validateQuantityOnly!=undefined&&validateQuantityOnly==true){return true;}if(!submitRequest()){return;}var beginIndex=wc.render.getContextById("ShopCartPaginationDisplay_Context").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0;}form.URL.value=form.URL.value+"&beginIndex="+beginIndex;form.submit();this.setFieldDirtyFlag(false);}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}},updateCartWithQuickCheckoutProfile:function(quickOrderId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.toOrderId=".";params.shippingAddressFromOrderProfile="1";params.shippingModeFromOrderProfile="1";params.URL="dummy";params.payInfoFrom=quickOrderId;params.orderInfoFrom=quickOrderId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.calculateOrder="1";params.quickCheckout="true";wc.service.declare({id:"QuickCheckOutOrderCopy",actionId:"QuickCheckOutOrderCopy",url:"AjaxOrderCopy",successHandler:function(serviceResponse){cursor_clear();document.location.href="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL=OrderShippingBillingView?langId="+CheckoutHelperJS.langId+"&storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&quickCheckoutProfileForPayment=true&chkSAPInvFlg=false";},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}cursor_clear();}});if(!submitRequest()){return;}cursor_wait();wc.service.invoke("QuickCheckOutOrderCopy",params);},addNewShippingAddress:function(addressType){this.displayAddressDetails(-1,addressType);},updateAddressForAllItems:function(addressSelectBox){if(addressSelectBox.value!=-1){this.selectedAddressesArray[addressSelectBox.name]=addressSelectBox.value;}if(!this.isAjaxCheckOut()){return;}var addressId=addressSelectBox.value;if(addressId==-1){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var addressId=document.getElementById("singleShipmentAddress").value;this.updateParamObject(params,"addressId",addressId,false);var enabledShipInstructions=false;var shipInstructions;if(document.getElementById("shipInstructions")!=null){shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions="";}enabledShipInstructions=true;}if(!submitRequest()){return;}cursor_wait();if(!enabledShipInstructions||shipInstructions==undefined||shipInstructions==""){wc.service.invoke("OrderItemAddressShipMethodUpdate",params);}else{wc.service.invoke("OrderItemAddressShipInstructionsUpdate",params);}},updateShipModeForAllItems:function(shipmentSelectBox){if(!this.isAjaxCheckOut()){return;}var shipModeId=shipmentSelectBox.value;if(shipModeId==-1){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"shipModeId",shipModeId,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateShippingInstructionsForAllItems:function(){if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;var shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions="";}if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);this.updateParamObject(params,"shipInstructions",shipInstructions,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateShippingChargeForShipModeAjax:function(curOrderId,shipModeId,shipChargeType,shipAcctNum){if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=curOrderId;params.URL="";params.shipModeId=shipModeId;params.shipChargTypeId=shipChargeType;if(shipAcctNum!=null&&shipAcctNum!=undefined){params.shipCarrAccntNum=shipAcctNum;}else{params.shipCarrAccntNum="";}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxOrderShipChargeUpdate",params);},updateShippingChargeForShipMode:function(myForm){if(this.isAjaxCheckOut()){return;}myForm.URL.value="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL=OrderShippingBillingView?forceShipmentType=2";myForm.submit();},hideShipChargeAccountField:function(selectValue,acctFieldId){if(document.getElementById(selectValue).value.indexOf("ByCarrier")>-1){document.getElementById(acctFieldId).style.display="block";}else{document.getElementById(acctFieldId).style.display="none";}},updateRequestedShipDate:function(jsDate){if(jsDate==null||jsDate.getDisplayedValue()==null){return;}var now=new Date();if(jsDate.compare(jsDate.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}if(!this.isAjaxCheckOut()){return;}var t="";if(jsDate.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDate);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDate.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}jsDate._close();this.updateShippingDateForAllItems(t);},updateShippingDateForAllItems:function(date){params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"requestedShipDate",date,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},displayAddressDetails:function(addressSelectBoxValue,addressType){if(!this.isAjaxCheckOut()){this.displayAddressDetailsWeb10(addressSelectBoxValue,addressType);}else{if(addressSelectBoxValue!=-1){if(!submitRequest()){return;}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("shippingAddressContext",{shippingAddress:addressSelectBoxValue});}else{this.createAddress(-1,addressType);}}},displayAddressDetailsWeb10:function(addressSelectBoxValue,addressType){var selectedAddressId=addressSelectBoxValue;var addressSelectBox=dojo.byId("singleShipmentAddress");for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block";}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none";}}if(selectedAddressId==-1){this.createAddress(-1,addressType);}},initDojoEventListenerSingleShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){if(dojo.byId("singleShipmentAddress")!=null){dojo.connect(dojo.byId("singleShipmentAddress"),"onchange",setDirtyFlag);}if(dojo.byId("WC_ShippingAddressSelectSingle_div_2")!=null){dojo.connect(dojo.byId("WC_ShippingAddressSelectSingle_div_2"),"onclick",setDirtyFlag);}if(dojo.byId("singleShipmentShippingMode")!=null){dojo.connect(dojo.byId("singleShipmentShippingMode"),"onchange",setDirtyFlag);}if(dojo.byId("shipAsComplete")!=null){dojo.connect(dojo.byId("shipAsComplete"),"onclick",setDirtyFlag);}if(dojo.byId("shippingInstructionsCheckbox")!=null){dojo.connect(dojo.byId("shippingInstructionsCheckbox"),"onclick",setDirtyFlag);}if(dojo.byId("requestShippingDateCheckbox")!=null){dojo.connect(dojo.byId("requestShippingDateCheckbox"),"onclick",setDirtyFlag);}if(dojo.byId("shipInstructions")!=null){dojo.connect(dojo.byId("shipInstructions"),"onchange",setDirtyFlag);}if(dojo.byId("expediteShipping")!=null){dojo.connect(dojo.byId("expediteShipping"),"onchange",setDirtyFlag);}if(dojo.byId("expediteShipping_1")!=null){for(var i=0;i<totalItems;i++){if(dojo.byId("qty_"+(i+1)).value!="-1"){var object=dojo.byId("expediteShipping_"+(i+1));dojo.connect(object,"onchange",setDirtyFlag);}}}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}},updateSingleShipmentShoppingCart:function(form){var formAction="OrderChangeServiceShipInfoUpdate?";var updateShippingURL="OrderChangeServiceShipInfoUpdate?";var instructions=null;var t=null;if(dojo.byId("shippingInstructionsCheckbox")!=null){if(dojo.byId("shippingInstructionsCheckbox").checked){if(document.getElementById("shipInstructions")!=null&&document.getElementById("shipInstructions").value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("shipInstructions").value,4000)){instructions=document.getElementById("shipInstructions").value;}else{MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}}}else{if(document.getElementById("shipInstructions")!=null){instructions="";}}}if(dojo.byId("requestShippingDateCheckbox")!=null){var jsDateObj=dijit.byId("requestedShippingDate");if(dojo.byId("requestShippingDateCheckbox").checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue;}}}if(document.getElementById("singleShipmentAddress").value!=-1){updateShippingURL=updateShippingURL+"addressId="+document.getElementById("singleShipmentAddress").value;}else{MessageHelper.formErrorHandleClient(document.getElementById("singleShipmentAddress").id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);return;}formAction=formAction+"shipModeId="+document.getElementById("singleShipmentShippingMode").value;if(this.shipChargeEnabled){formAction=formAction+"&shippingChargeType="+document.getElementById("shipChargTypeId_1").value;formAction=formAction+"&shipCarrAccntNum="+document.getElementById("shipCarrAccntNum_1").value;}var shipInstructions="";if(instructions!=null){shipInstructions="shipInstructions%3D"+instructions+"%26orderItemId_1%3D"+document.getElementById("orderItem_1").value;}if(t!=null){formAction=formAction+"&requestedShipDate="+t;}var checkBox=document.getElementById("shipAsComplete");if(checkBox.checked){formAction=formAction+"&ShipAsComplete=Y";}else{formAction=formAction+"&ShipAsComplete=N";}if(document.getElementById("expediteShipping_1")!=null){var totalNumberOfItemsOnPage=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalNumberOfItemsOnPage;i++){if(document.getElementById("qty_"+(i+1)).value!="-1"){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId;}var object=document.getElementById("expediteShipping_"+(i+1));if(object.checked){document.getElementById("isExpedited_"+(i+1)).value="Y";}else{document.getElementById("isExpedited_"+(i+1)).value="N";}}}}form.action=formAction;var beginIndex=wc.render.getContextById("traditionalShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0;}form.URL.value=updateShippingURL+"&requestedShipDate*=&shipModeId*=&orderItemId*=&URL=OrderChangeServiceShipInfoUpdate%3F"+shipInstructions+"%26allocate%3D***%26backorder%3D***%26remerge%3D***%26check%3D*n%26URL%3DOrderShippingBillingView%3F%26beginIndex%3D"+beginIndex;if(!submitRequest()){return;}form.submit();},moveAllItemsToSingleShipment:function(){var orderItemId=document.getElementById("orderItem_1").value;var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"addressId",addressId,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate1",params);},addNewShippingAddressForMS:function(orderItemId){if(categoryDisplayJS.storeFlow=="GGW"){MessageHelper.hideAndClearMessage();}this.updateAddressIdForThisItem(-1,orderItemId);},updateAddressIdForThisItem:function(addressBoxValue,orderItemId){if(addressBoxValue!=-1){var addressBox=dojo.byId("MS_ShipmentAddress_"+orderItemId);this.selectedAddressesArray[addressBox.name]=addressBoxValue;}if(addressBoxValue==-1){return;}if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var addressId=addressBoxValue;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateShipModeForThisItem:function(shipModeBox,orderItemId){var shipModeId=shipModeBox.value;if(shipModeId==-1){return;}if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateShippingInstructionsForThisItem:function(textArea,orderItemId){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;var shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;var shipInstructions=textArea.value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions="";}if(this.isAjaxCheckOut()){if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(textArea.id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}}this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,shipInstructions);if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);this.updateParamObject(params,"shipInstructions",shipInstructions,false,-1);this.updateParamObject(params,"orderItemId",orderItemId,false,-1);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateRequestedShipDateForThisItem:function(jsDate,orderItemId,shippingCondition,invokeSAP){if(jsDate==null||jsDate.getDisplayedValue()==null){return;}var now=new Date();if(jsDate.compare(jsDate.getValue(),now)<=0){if(document.getElementById("MS_requestedShippingDate_"+orderItemId)!=null){MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}if(!this.isAjaxCheckOut()){return;}var t="";if(jsDate.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDate);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDate.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}jsDate._close();var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;var shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"requestedShipDate",t,false,-1);params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";params.addressId=addressId;if(!submitRequest()){return;}cursor_wait();CheckoutHelperJS.RequestShippingDateAction=true;wc.service.declare({id:"reserveDeliveryApptDates",actionId:"reserveDeliveryApptDates",url:"AjaxReserveDeliveryApptDates",formId:"",successHandler:function(serviceResponse){params.apptRefNum=serviceResponse.apptRefNum;wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}wc.service.invoke("OrderItemAddressShipMethodUpdate",params);}});cursor_wait();wc.service.invoke("reserveDeliveryApptDates",{storeId:storeId,catalogId:catalogId,langId:langId,orderItemId:orderItemId,addressId:addressId,appointmentDate:t,shippingCondition:shippingCondition,invokeSAP:invokeSAP});},createAddressForMS:function(orderItemId,addressType){this.saveOrderItemsList(orderItemId,"-1");if(!submitRequest()){return;}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType});this.showHideDivs("editAddressContents","mainContents");},displayAddressDetailsForMSHelper:function(orderItemId,addressType){this.displayAddressDetailsForMS(-1,orderItemId,addressType);},displayAddressDetailsForMS:function(addressSelectBoxValue,orderItemId,addressType){if(this.isAjaxCheckOut()){if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}}else{if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}else{dojo.byId("MS_shippingAddressDisplayArea_"+orderItemId).innerHTML=dojo.byId("addressDetails_"+addressSelectBoxValue).innerHTML;}}},initDojoEventListenerMultiShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){var list_clickable=new dojox.collections.ArrayList([]);var list_editable=new dojox.collections.ArrayList([]);for(var i=0;i<totalItems;i++){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;var object="";if(orderItemId!=null){object=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(object!=null){list_clickable.add(object);}object=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(object!=null){list_clickable.add(object);}object=dojo.byId("shipAsComplete");if(object!=null){list_clickable.add(object);}object=dojo.byId("editAddressButton");if(object!=null){list_clickable.add(object);}object=dojo.byId("MS_expediteShipping_"+orderItemId);if(object!=null){list_clickable.add(object);}object=dojo.byId("MS_ShipmentAddress_"+orderItemId);if(object!=null){list_editable.add(object);}object=dojo.byId("MS_ShippingMode_"+orderItemId);if(object!=null){list_editable.add(object);}object=dojo.byId("MS_shipInstructions_"+orderItemId);if(object!=null){list_editable.add(object);}object=dojo.byId("qty_"+(i+1));if(object!=null){list_editable.add(object);}}else{var j=i+1;console.debug("error: element 'orderItem_'"+j+" was expected but undefined.");}}for(var i=0;i<list_clickable.count;i++){var item=list_clickable.item(i);dojo.connect(item,"onclick",setDirtyFlag);}for(var i=0;i<list_editable.count;i++){var item=list_editable.item(i);dojo.connect(item,"onchange",setDirtyFlag);}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}},updateMultiShipmentShoppingCart:function(form){var updateShippingAction="OrderChangeServiceShipInfoUpdate";var updateShippingURL="OrderShippingBillingView?";var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId;}var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(addressId!=-1){if(document.getElementById("addressId_"+(i+1))!=null){document.getElementById("addressId_"+(i+1)).value=addressId;}}else{MessageHelper.formErrorHandleClient(document.getElementById("MS_ShipmentAddress_"+orderItemId).id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);return;}if(form.elements["shipModeId_"+(i+1)]!=null){form.elements["shipModeId_"+(i+1)].value=document.getElementById("MS_ShippingMode_"+orderItemId).value;}var instructions=null;var t=null;var shippingInstructionsCheckbox=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(shippingInstructionsCheckbox!=null){if(shippingInstructionsCheckbox.checked){if(document.getElementById("MS_shipInstructions_"+orderItemId)!=null&&document.getElementById("MS_shipInstructions_"+orderItemId).value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("MS_shipInstructions_"+orderItemId).value,4000)){instructions=document.getElementById("MS_shipInstructions_"+orderItemId).value;}else{MessageHelper.formErrorHandleClient(document.getElementById("MS_shipInstructions_"+orderItemId).id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}}}else{if(document.getElementById("MS_shipInstructions_"+orderItemId)!=null){instructions="";}}}var requestShippingDateCheckbox=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(requestShippingDateCheckbox!=null){t=this.resetRequestedShipDateValue;var jsDateObj=dijit.byId("MS_requestedShippingDate_"+orderItemId);if(requestShippingDateCheckbox.checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("MS_requestedShippingDate_"+orderItemId)!=null){MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue;}}}if(instructions!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("shipInstructions_"+(i+1))!=null){document.getElementById("shipInstructions_"+(i+1)).value=instructions;}}}if(t!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("requestedShipDate_"+(i+1))!=null){document.getElementById("requestedShipDate_"+(i+1)).value=t;}}}if(document.getElementById("MS_expediteShipping_"+orderItemId)!=null&&document.getElementById("isExpedited_"+(i+1))!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("MS_expediteShipping_"+orderItemId).checked){document.getElementById("isExpedited_"+(i+1)).value="Y";}else{document.getElementById("isExpedited_"+(i+1)).value="N";}}}}var checkBox=document.getElementById("shipAsComplete");if(document.getElementById("ShipAsComplete")!=null){if(checkBox.checked){document.getElementById("ShipAsComplete").value="Y";}else{document.getElementById("ShipAsComplete").value="N";}}updateShippingURL=updateShippingURL+"orderItemId*=";updateShippingURL=updateShippingURL+"&quantity*=";updateShippingURL=updateShippingURL+"&addressId*=";updateShippingURL=updateShippingURL+"&shipModeId*=";updateShippingURL=updateShippingURL+"&shipInstructions*=";updateShippingURL=updateShippingURL+"&requestedShipDate*=";updateShippingURL=updateShippingURL+"&isExpedited*=";updateShippingURL=updateShippingURL+"&ShipAsComplete*=";updateShippingURL=updateShippingURL+"&orderItem*=";updateShippingURL=updateShippingURL+"&MS_ShipmentAddress*=";updateShippingURL=updateShippingURL+"&MS_ShippingMode*=";updateShippingURL=updateShippingURL+"&MS_shippingInstructionsCheckbox*=";updateShippingURL=updateShippingURL+"&MS_shipInstructions*=";updateShippingURL=updateShippingURL+"&MS_requestShippingDateCheckbox*=";updateShippingURL=updateShippingURL+"&MS_requestedShippingDate*=";updateShippingURL=updateShippingURL+"&MS_expediteShipping*=";updateShippingURL=updateShippingURL+"&qty*=";updateShippingURL=updateShippingURL+"&shipAsComplete*=";var beginIndex=wc.render.getContextById("multipleShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0;}updateShippingURL=updateShippingURL+"&beginIndex="+beginIndex;form.action=updateShippingAction;form.URL.value=updateShippingURL;if(!submitRequest()){return;}form.submit();},showHideEditAddressLink:function(addressSelectBox,orderItemId){var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editAddressLink_"+orderItemId).style.display="none";break;}else{dojo.byId("editAddressLink_"+orderItemId).style.display="block";}}}}else{if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){dojo.byId("editAddressLink_"+orderItemId).style.display="block";}}},showHideEditBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if(addressSelectBox.value=="-2"){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";return;}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break;}else{dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block";}}}}else{if(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";}}},setOrderId:function(orderId){this.orderId=orderId;},getOrderId:function(){return this.orderId;},showHideCreateBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if(addressSelectBox.value=="-2"){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";return;}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break;}else{dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block";}}}}else{if(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";}}},updateWHRAddressIdForThisItem:function(addressId){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var orderItemId=null;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItemsAddressId",params);},displayWHRAddressDetailsForMS:function(addressSelectBoxValue,orderItemId,addressType){if(this.isAjaxCheckOut()){if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}}else{if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}else{var orderItemId=null;var qty=null;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;dojo.byId("MS_shippingAddressDisplayArea_"+orderItemId).innerHTML=dojo.byId("addressDetails_"+addressSelectBoxValue).innerHTML;document.getElementById("MS_ShipmentAddress_"+orderItemId).value=addressSelectBox.value;}}}},updateWHRShipModeForThisItem:function(shipModeBox,currentffmCenterId,orderItemId){var shipModeId=shipModeBox.value;var shipModeText=shipModeBox.options[shipModeBox.selectedIndex].text;var willCall=false;if(shipModeText=="Will Call"){willCall=true;}if(shipModeId==-1){return;}var totalItems=document.getElementById("totalNumberOfItems").value;if(!this.isAjaxCheckOut()){return;}var ffmCenterId=null;var orderItemId=null;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";params.willCall=willCall;for(var i=0;i<totalItems;i++){ffmCenterId=document.getElementById("ffmCenter_"+(i+1)).value;orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(ffmCenterId==currentffmCenterId){document.getElementById("MS_ShippingMode_"+orderItemId).value=shipModeId;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);}}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateWHRServiceOptionsWait:function(additionalSKUElement,region,currentffmCenterId,orderItemId,currentIndex,skuType,currentSKUs,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}if(skuType!=1&&skuType!=2&&skuType!=3){return;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;this.updateWHRServiceOptions(additionalSKUElement,region,currentffmCenterId,orderItemId,currentIndex,skuType,currentSKUs,this.keyPressCount[orderItemId]);},updateWHRServiceOptions:function(additionalSKUElement,region,currentffmCenterId,orderItemId,currentIndex,skuType,currentSKUs,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var additionalSKU=(additionalSKUElement.value);var servicesArray=[];servicesArray=currentSKUs.toString().split("_");var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var newSKUs;if(skuType==1){if(additionalSKUElement.length==0){var clearGiftMessage=" ";var itemsChecked=0;$("#page.shoppingCartPage #order_details div #giftWrap input.checkbox").each(function(){if($(this).prop("checked")){itemsChecked++;}});if(itemsChecked==0){this.updateParamObject(params,"field3",clearGiftMessage,false);}newSKUs="_";}else{newSKUs=additionalSKUElement+"_";}if(servicesArray[1]!=undefined&&servicesArray[1].length>0){newSKUs=newSKUs+servicesArray[1]+"_";}for(i=2;i<servicesArray.length;i++){if(servicesArray[i].length>0){newSKUs=newSKUs+servicesArray[i]+"_";}}}else{if(skuType==2){newSKUs=servicesArray[0]+"_"+additionalSKU+"_";}else{newSKUs=servicesArray[0]+"_";var mandServiceChecked=false;var serviceItemCount;var optionSelected;var mandServiceOptionsId=dojo.query("input[id^='MandatoryServiceOptions_"+orderItemId+"_']");if(mandServiceOptionsId.some(function(field,i){var mandServiceOptionsFields=field.id.split("MandatoryServiceOptions_")[1];var itemId=orderItemId;var serviceId=mandServiceOptionsFields.split("_")[1];serviceItemCount=$("#MS_Options_Count_"+itemId).val();var radioButtonServicesName="MandatoryServiceOptions_"+itemId;var radioButtonServicesId="MandatoryServiceOptions_"+itemId+"_"+serviceId;var mandServOpt=document.getElementById(radioButtonServicesId);if(serviceItemCount==1){optionSelected=$("#MSOption_Selected_"+itemId).val();if(optionSelected=="true"){newSKUs=newSKUs+mandServOpt.value;mandServiceChecked=true;return true;}}else{if(mandServOpt.checked){newSKUs=newSKUs+mandServOpt.value;mandServiceChecked=true;return true;}}})){if(!isNaN(servicesArray[1])&&!mandServiceChecked){newSKUs=newSKUs+servicesArray[1];}}newSKUs=newSKUs+"_";}}var optSrvIndex=1;var productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);while(productElement!=null){if(productElement!=null){if(productElement.checked){newSKUs=newSKUs+productElement.value+"_";}}else{break;}optSrvIndex++;productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);}var totalItems=document.getElementById("totalNumberOfItems").value;if(region=="NAR"){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"comment",newSKUs,false,-1);if(categoryDisplayJS.storeFlow=="GGW"&&$("#OrderItemRoomGrp_"+orderItemId).val()!=null&&$("#OrderItemRoomGrp_"+orderItemId).val()!=""){categoryDisplayJS.setExpandCollaps("Expand_"+$("#OrderItemRoomGrp_"+orderItemId).val());}}else{if(region=="WER"){var ffmCenterId=null;var orderItemIdinFfmCenter=null;var mandatoryserviceChecked=null;var optionalserviceChecked=null;if(skuType==2){mandatoryserviceChecked=document.getElementById("MandatoryServiceOptions_"+orderItemId+"_"+currentIndex).checked;}else{if(skuType==3){optionalserviceChecked=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+currentIndex).checked;}}for(var i=0;i<totalItems;i++){ffmCenterId=document.getElementById("ffmCenter_"+(i+1)).value;orderItemIdinFfmCenter=document.getElementById("orderItem_"+(i+1)).value;if(ffmCenterId==currentffmCenterId){if(orderItemId!=orderItemIdinFfmCenter){if(skuType==2){dojo.byId("MandatoryServiceOptions_"+orderItemIdinFfmCenter+"_"+currentIndex).checked=mandatoryserviceChecked;}else{if(skuType==3){dojo.byId("OptionalServiceOptions_"+orderItemIdinFfmCenter+"_"+currentIndex).checked=optionalserviceChecked;}}}this.updateParamObject(params,"orderItemId",orderItemIdinFfmCenter,false,-1);this.updateParamObject(params,"comment",newSKUs,false,-1);}}}}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},toggleServiceOptionsDisplay:function(form,orderItemId,homeDeliveryId){var shipDropDown=document.getElementById("MS_ShippingMode_"+orderItemId);if(shipDropDown[shipDropDown.selectedIndex].value==homeDeliveryId){CheckoutHelperJS.showDiv("ServiceOptionsDiv");CheckoutHelperJS.showDiv("ServiceOptionsDiv1");CheckoutHelperJS.showDiv("ServiceOptionsDiv2");}else{CheckoutHelperJS.hideDiv("ServiceOptionsDiv");CheckoutHelperJS.hideDiv("ServiceOptionsDiv1");CheckoutHelperJS.hideDiv("ServiceOptionsDiv2");}},showDiv:function(divName){var theDiv=document.getElementById(divName);theDiv.style.visibility="visible";theDiv.style.display="block";},hideDiv:function(divName){var theDiv=document.getElementById(divName);theDiv.style.visibility="hidden";theDiv.style.display="none";},WHRaddGiftWrap:function(checkBoxName,giftWrapId,orderItemId,region,currentffmCenterId,currentIndex,currentSKUs,keyPressCountValue){thisCheckBoxName=checkBoxName;var thisCheckBox=dojo.byId(thisCheckBoxName);if(thisCheckBox.checked){setTimeout(dojo.hitch(this,"updateWHRServiceOptions",giftWrapId,region,currentffmCenterId,orderItemId,currentIndex,1,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);}else{giftWrapId="";setTimeout(dojo.hitch(this,"updateWHRServiceOptions",giftWrapId,region,currentffmCenterId,orderItemId,currentIndex,1,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);}},displayGiftMsg:function(){var itemsChecked=0;$("#page.shoppingCartPage #order_details div #giftWrap input.checkbox").each(function(){if($(this).prop("checked")){itemsChecked++;}});if(itemsChecked>0){if($("#page.shoppingCartPage #box #MS_giftMessageDiv").css("display")=="none"){$("#page.shoppingCartPage #box #MS_giftMessageDiv").css("display","inline");}}else{$("#page.shoppingCartPage #box #MS_giftMessageDiv").css("display","none");}},WHRreturnZipCodeFromCookie:function(zipID){var zipCode="";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){zipCode=zipRegCookie.split("|")[0];zipCode=zipCode.split("%")[0];}dojo.byId(zipID).value=zipCode;},WHRlimitTextLength:function(textAreaName,countFieldName){var textArea=dojo.byId(textAreaName);var textLength=textArea.value.length;var countField=dojo.byId(countFieldName);if(countFieldName!=null){countField.value=this.giftMessageMaxLength-textArea.value.length;}},updateCartWaitFrequency:function(freqBox,statcount,orderItemId,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateCartFrequency",freqBox,statcount,orderItemId,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateCartFrequency:function(freqBox,statusCount,orderItemId,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var frequency=(freqBox.value);var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"frequency",frequency,false,-1);params.frequency=frequency;params.invCheck="false";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},changeDelDateWithFreq:function(frequency,nxtShipDate){var freq=document.getElementById(frequency).value;var nextShip=new Date(nxtShipDate);var byMonths=0;if(freq==1){byMonths=1;}if(freq==2){byMonths=2;}if(freq==3){byMonths=3;}if(freq==6){byMonths=6;}if(freq==9){byMonths=9;}nextShip.setMonth(nextShip.getMonth()+byMonths);var dateObj=dijit.byId("MS_requestedShippingDate_1");dateObj.attr("value",nextShip);},preSelectTopMandatoryService:function(orderItemsArr){var orderItemsArray=[];orderItemsArray=orderItemsArr.slice(1).split("_");var isTopServiceChecked=false;if(orderItemsArray.length>0){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var serviceItemCount;var optionSelected;for(var i=0;i<orderItemsArray.length;i++){var orderItemIndex=i+1;serviceItemCount=$("#MS_Options_Count_"+orderItemsArray[i]).val();optionSelected=$("#MSOption_Selected_"+orderItemsArray[i]).val();if(serviceItemCount==1){if(optionSelected!="true"){var serviceId=$("input[type=hidden][name=MandatoryServiceOptions_"+orderItemsArray[i]+"]").val();this.updateParamObject(params,"orderItemId",orderItemsArray[i],false,-1);this.updateParamObject(params,"comment","_"+serviceId+"_",false,-1);isTopServiceChecked=true;}}else{var checkedService=$("input[type=radio][name=MandatoryServiceOptions_"+orderItemsArray[i]+"]:checked").val();if(checkedService==undefined){var serviceEl=$("input[type=radio][name=MandatoryServiceOptions_"+orderItemsArray[i]+"]").filter(":first");var serviceId=serviceEl.val();serviceEl.attr("checked","checked");this.updateParamObject(params,"orderItemId",orderItemsArray[i],false,-1);this.updateParamObject(params,"comment","_"+serviceId+"_",false,-1);isTopServiceChecked=true;}}}console.log("isTopServiceChecked",isTopServiceChecked);if(isTopServiceChecked){cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);}}},cardinalCheckout:function(orderId,flowType,paymentType){MessageHelper.hideAndClearMessage();var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=orderId;params.flowType=flowType;params.paymentType=paymentType;var form=document.forms.frmCardinalLaunch;var termUrl=form.TermUrl.value;termUrl=termUrl+"&paymentType="+paymentType;form.TermUrl.value=termUrl;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxCardinalCheckout",params);},showDeliveryDefault:function(){if(document.getElementById("hddatePickerTB")!=null&&document.getElementById("hddatePickerTB")!=undefined){var hdDatePickerOrdItmId=document.getElementById("hddatePickerTB").value;if($("#MS_requestedShippingDate_"+hdDatePickerOrdItmId).val()==""){$("#MS_requestedShippingDate_"+hdDatePickerOrdItmId).attr("placeholder","mm/dd/yyyy");}}}};