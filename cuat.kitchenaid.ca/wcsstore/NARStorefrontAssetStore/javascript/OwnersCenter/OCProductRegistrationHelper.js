dojo.require("wc.service.common");var ifSubmit=false;OCProductRegistrationHelper={modelNumCounter:0,activeForm:"",modelNumValidation:function(form){OCProductRegistrationHelper.activeForm=form;if(storeId=="10202"||storeId=="10212"||storeId=="10211"||storeId=="10227"){reWhiteSpace=new RegExp(/^\s+$/);var topErrorMsg="";if(document.getElementById("form_error").innerHTML.length>0){topErrorMsg="";}else{topErrorMsg=MessageHelper.messages.ERROR_TOP;}var modelNumberOK=true;if($("#modelNumber").length>0&&$("#modelNumber").val().length>=8){if(this.modelNumCounter===0){$.ajax({type:"GET",url:getAbsoluteURL()+"OCModelNumberValidation",data:{langId:langId,storeId:storeId,modelNumber:$("#modelNumber").val().trim()},success:function(data){try{var resp=$.parseJSON(data.replace(/^\s*\/\*/,"").replace(/\*\/\s*$/,""));}catch(e){console.debug(e);}if(resp.isValidated){OCProductRegistrationHelper.prepareSubmit(document.productRegistration);}else{$("#modelNumberValidationErrorMsg").text(MessageHelper.messages.ERROR_modelNumberInvalidAJAX);OCProductRegistrationHelper.modelNumCounter++;}}});}else{OCProductRegistrationHelper.prepareSubmit(form);}}else{form.modelNumber.value=trim(form.modelNumber.value);if(form.modelNumber!=null&&reWhiteSpace.test(form.modelNumber.value)||form.modelNumber.value==""){document.getElementById("modelNumberValidationErrorMsg").innerHTML='<span id="modelNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_modelNumberEmpty+"</span>";modelNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(form.modelNumber.value.length<4){document.getElementById("modelNumberValidationErrorMsg").innerHTML='<span id="modelNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_modelNumberTooLongTooShort+"</span>";modelNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(!OCProductRegistrationHelper.isAlphaNumeric(form.modelNumber.value)){document.getElementById("modelNumberValidationErrorMsg").innerHTML='<span id="modelNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_modelNumberInvalid+"</span>";modelNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{document.getElementById("modelNumberValidationErrorMsg").innerHTML="";modelNumberOK=true;}}}}}else{OCProductRegistrationHelper.prepareSubmit(form);}},prepareSubmit:function(form){OCProductRegistrationHelper.activeForm=form;var ifALLisOK=true;reWhiteSpace=new RegExp(/^\s+$/);var ifAddressOK=true;var topErrorMsg="";if(document.getElementById("form_error").innerHTML.length>0){topErrorMsg="";}else{topErrorMsg=MessageHelper.messages.ERROR_TOP;}ifAddressOK=OCAddressHelper.validateAddressForm(form);var emailConfOK=true;var priceOK=true;var modelNumberOK=true;var purchaseLocationOK=true;var purchaseDateOK=true;var serialNumberOK=true;form.modelNumber.value=trim(form.modelNumber.value);if(form.modelNumber!=null&&reWhiteSpace.test(form.modelNumber.value)||form.modelNumber.value==""){document.getElementById("modelNumberValidationErrorMsg").innerHTML='<span id="modelNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_modelNumberEmpty+"</span>";modelNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(form.modelNumber.value.length<4){document.getElementById("modelNumberValidationErrorMsg").innerHTML='<span id="modelNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_modelNumberTooLongTooShort+"</span>";modelNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(!OCProductRegistrationHelper.isAlphaNumeric(form.modelNumber.value)){document.getElementById("modelNumberValidationErrorMsg").innerHTML='<span id="modelNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_modelNumberInvalid+"</span>";modelNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{document.getElementById("modelNumberValidationErrorMsg").innerHTML="";modelNumberOK=true;}}}var userType=form.userType.value;if(userType=="R"){form.serialNumber.value=trim(form.serialNumber.value);if(form.serialNumber.value!=null&&form.serialNumber.value!=""){if(!OCProductRegistrationHelper.isAlphaNumeric(form.serialNumber.value)){document.getElementById("serialNumberValidationErrorMsg").innerHTML='<span id="serialNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_serialNumberInvalid+"</span>";serialNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(form.serialNumber.value.length<4){document.getElementById("serialNumberValidationErrorMsg").innerHTML='<span id="serialNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_serialNumberTooLong+"</span>";serialNumberOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{serialNumberOK=true;}}}else{document.getElementById("serialNumberValidationErrorMsg").innerHTML='<span id="serialNumber_Error" class="field_error">'+MessageHelper.messages.ERROR_serialNumberEmpty+"</span>";serialNumberOK=true;}}form.purchaseDate.value=trim(form.purchaseDate.value);if(form.purchaseDate!=null&&reWhiteSpace.test(form.purchaseDate.value)||form.purchaseDate.value==""){document.getElementById("purchaseDateValidationErrorMsg").innerHTML='<span id="purchaseDate_Error" class="field_error">'+MessageHelper.messages.ERROR_purchaseDateEmpty+"</span>";purchaseDateOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(validateDate(form.purchaseDate.value,"en_US")!="true"){document.getElementById("purchaseDateValidationErrorMsg").innerHTML='<span id="purchaseDate_Error" class="field_error">'+MessageHelper.messages.ERROR_purchaseDateInvalid+"</span>";purchaseDateOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{if(OCProductRegistrationHelper.chkDtgtCurrDt(form.purchaseDate.value)){document.getElementById("purchaseDateValidationErrorMsg").innerHTML='<span id="purchaseDate_Error" class="field_error">'+MessageHelper.messages.ERROR_purchaseDategtCurrDate+"</span>";purchaseDateOK=false;document.getElementById("TopValidationErrorMsg").innerHTML=topErrorMsg;}else{document.getElementById("purchaseDateValidationErrorMsg").innerHTML="";purchaseDateOK=true;}}}if(ifSubmit){return false;}if((ifAddressOK==true)&&(emailConfOK==true)&&(priceOK==true)&&(modelNumberOK==true)&&(purchaseDateOK==true)&&(purchaseLocationOK==true)&&(serialNumberOK==true)){document.getElementById("TopValidationErrorMsg").innerHTML="";document.getElementById("form_error").innerHTML="";ifSubmit=true;if($("#registria_api_key").length>0){var purchaseOptions="";$("input.purchaseOption:checked").each(function(){purchaseOptions+=(purchaseOptions==""?"":",")+$(this).attr("name");purchaseOptions=purchaseOptions.split(",");});var registriaPerson={firstName:"",lastName:"",address1:"",address2:"",city:"",state:"",zip:"",phone:"",email:"",init:function(){if($("#firstName").length>0){registriaPerson.firstName=$("#firstName").val();registriaPerson.lastName=$("#lastName").val();registriaPerson.address1=$("#address1").val();registriaPerson.address2=$("#address2").val();registriaPerson.city=$("#city").val();registriaPerson.state=$("#state").val();registriaPerson.zip=$("#zipCode").val();registriaPerson.phone=$("#phoneNumber").val();registriaPerson.email=$("#email1").val();}else{if($("#firstNameDiv").length>0){registriaPerson.firstName=$("#firstNameDiv").html();registriaPerson.lastName=$("#lastNameDiv").html();registriaPerson.address1=$("#address1Div").html();registriaPerson.address2=$("#address2Div").html();registriaPerson.city=$("#cityDiv").html();registriaPerson.state=$("#stateDiv").html();registriaPerson.zip=$("#zipDiv").html();registriaPerson.phone=$("#phoneDiv").html();registriaPerson.email=$("#email1Div").html();}}}};registriaPerson.init();$.ajax({type:"POST",url:registriaServiceUrl,data:{api_key:$("#registria_api_key").val(),"user[first_name]":registriaPerson.firstName,"user[last_name]":registriaPerson.lastName,"user[address1]":registriaPerson.address1,"user[address2]":registriaPerson.address2,"user[city]":registriaPerson.city,"user[state]":registriaPerson.state,"user[zip]":registriaPerson.zip,"user[phone]":registriaPerson.phone,"user[email]":registriaPerson.email,"product[sku]":$("#modelNumber").val(),"product[serial_number]":$("#serialNumber").val(),"product[purchase_date]":$("#purchaseDate").val(),"product[price_paid]":$("#price").val(),"product[purchased_at]":$("#purchaseLocation").val(),"product[plan_purchase_major_next_months]":purchaseOptions},success:function(data,textStatus,jqXHR){cursor_clear();if(textStatus=="success"){if($("#userType").length>0&&$("#userType").val()=="R"){$("#"+OCProductRegistrationHelper.activeForm.id).removeAttr("onsubmit").submit();}else{window.location.href=productRegistrationSuccessUrl;}return;}$("#TopValidationErrorMsg").html($("#RegistriaMessage_GeneralError").html()).show();},error:function(){cursor_clear();$("#TopValidationErrorMsg").html($("#RegistriaMessage_GeneralError").html()).show();},dataType:"json"});}else{form.submit();}displayProgressBar();}else{$(".field_error").css("display","block");$(".form_error").css("display","block");}},checkPurchaseIntent:function(checkbox){var purchaseIntentStr=document.productRegistration.purchaseIntent.value;if(checkbox.checked==true){if(purchaseIntentStr.length>0){purchaseIntentStr=purchaseIntentStr+","+checkbox.name;}else{purchaseIntentStr=checkbox.name;}}else{var index=purchaseIntentStr.indexOf(checkbox.name);var len=checkbox.name.length;if(purchaseIntentStr.charAt(index-1)==","){purchaseIntentStr=purchaseIntentStr.replace(","+checkbox.name,"");}else{if(purchaseIntentStr.charAt(index+len)==","){purchaseIntentStr=purchaseIntentStr.replace(checkbox.name+",","");}else{purchaseIntentStr=purchaseIntentStr.replace(checkbox.name,"");}}}document.productRegistration.purchaseIntent.value=purchaseIntentStr;},retainPurchaseIntent:function(){var purchaseIntent=document.productRegistration.purchaseIntent.value;if(purchaseIntent!=""){var currentTagTokens=purchaseIntent.split(",");for(var i=0;i<currentTagTokens.length;i++){document.getElementById(currentTagTokens[i]).checked=true;}}},chkDtgtCurrDt:function(dateval){var dt=new Date();var cdt=Date.parse(dateval);if(cdt>dt){return true;}return false;},isAlphaNumeric:function(str){if(str.search(/[^a-zA-Z0-9-]/g)!=-1){return false;}else{return true;}},tagPurchaseIntent:function(purchaseIntentValue){var intent=purchaseIntentValue.toLowerCase().split(",").join("_");var tag="on_page_Register_Product_"+intent+"_register";}};