dojo.require("dojox.collections.ArrayList");dojo.require("wc.widget.Tooltip");CheckoutHelperJS={langId:"-1",storeId:"",catalogId:"",orderId:"",shipmentTypeId:"",orderItemIds:[],updateWaitTimeOut:1500,keyPressCount:{},ajaxCheckOut:true,singlePageCheckout:true,selectedAddressesArray:{},dataDirty:{},fieldDirtyFlag:false,resetRequestedShipDateValue:"1970-01-01T00:00:00.000Z",shoppingCartPage:false,pendingOrderDetailsPage:false,RequestShippingDateAction:false,giftMessageMaxLength:180,shipChargeEnabled:false,setShipChargeEnabled:function(enabled){this.shipChargeEnabled=enabled;},updateParamObject:function(params,key,value,toArray,index){if(params==null){params=[];}if(params[key]!=null&&toArray){if(dojo.lang.isArrayLike(params[key])){if(index!=null&&index!=""){params[key][index]=value;}else{params[key].push(value);}}else{var tmpValue=params[key];params[key]=[];params[key].push(tmpValue);params[key].push(value);}}else{if(index!=null&&index!=""&&index!=-1){params[key+"_"+index]=value;}else{if(index==-1){var i=1;while(params[key+"_"+i]!=null){i++;}params[key+"_"+i]=value;}else{params[key]=value;}}}return params;},checkRequestShippingDateBox:function(checkBoxName,divName,suffix){var thisCheckBoxName;var thisDivName;if(suffix!=null&&suffix!=""){checkBoxName=checkBoxName+"_"+suffix;divName=divName+"_"+suffix;}var checkBox=dojo.byId(checkBoxName);var addressId,shipModeId="";if(this.shipmentTypeId=="1"){addressId=document.getElementById("singleShipmentAddress").value;shipModeId=document.getElementById("singleShipmentShippingMode").value;}else{if(this.shipmentTypeId=="2"){addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value;shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value;}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}if(checkBox.checked){dojo.byId(divName).style.visibility="visible";dojo.byId(divName).style.display="block";}else{dojo.byId(divName).style.visibility="hidden";dojo.byId(divName).style.display="none";}if(!checkBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);if(dijit.byId("requestedShippingDate")!=null||dijit.byId("MS_requestedShippingDate_"+suffix)!=null){this.updateParamObject(params,"requestedShipDate",this.resetRequestedShipDateValue,false,-1);}var orderItemId=null;var qty=null;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){qty=document.getElementById("qty_"+(i+1)).value;orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(qty!=-1){if(this.shipmentTypeId=="1"){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);break;}else{if(this.shipmentTypeId=="2"){if(suffix!=null&&suffix!=""&&orderItemId==suffix){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);break;}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}}}if(!submitRequest()){return;}cursor_wait();CheckoutHelperJS.RequestShippingDateAction=true;wc.service.invoke("OrderItemAddressShipMethodUpdate",params);}},updateGiftMessageForThisOrder:function(){if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;var giftMessageTo=document.getElementById("MS_giftMessageTo").value;var giftMessageFrom=document.getElementById("MS_giftMessageFrom").value;var giftMessage=document.getElementById("MS_giftMessage").value;if(giftMessage.length<=this.giftMessageMaxLength){giftMessage="TO:"+giftMessageTo+" FROM:"+giftMessageFrom+" MESSAGE:"+giftMessage;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(giftMessage)){giftMessage="";}this.updateParamObject(params,"field3",giftMessage,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);}},checkShippingInstructionsBox:function(checkBoxName,divName,suffix){var thisCheckBoxName;var thisDivName;if(suffix!=null&&suffix!=""){thisCheckBoxName=checkBoxName+"_"+suffix;thisDivName=divName+"_"+suffix;}else{thisCheckBoxName=checkBoxName;thisDivName=divName;}var thisCheckBox=dojo.byId(thisCheckBoxName);if(thisCheckBox.checked){dojo.byId(thisDivName).style.visibility="visible";dojo.byId(thisDivName).style.display="block";}else{dojo.byId(thisDivName).style.visibility="hidden";dojo.byId(thisDivName).style.display="none";}var addressId,shipModeId="";if(this.shipmentTypeId=="1"){addressId=document.getElementById("singleShipmentAddress").value;shipModeId=document.getElementById("singleShipmentShippingMode").value;}else{if(this.shipmentTypeId=="2"){var orderItemId,tempAddressId,tempShipModeId="";addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value;shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){orderItemId=document.getElementById("orderItem_"+(i+1)).value;tempAddressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;tempShipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;if(tempShipModeId==shipModeId&&tempAddressId==addressId){var tempDivName=divName+"_"+orderItemId;var tempCheckBoxName=checkBoxName+"_"+orderItemId;if(thisCheckBox.checked){dojo.byId(tempDivName).style.visibility="visible";dojo.byId(tempDivName).style.display="block";dojo.byId(tempCheckBoxName).checked="checked";}else{dojo.byId(tempDivName).style.visibility="hidden";dojo.byId(tempDivName).style.display="none";dojo.byId(tempCheckBoxName).checked="";}}}}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}if(!thisCheckBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;if(this.shipmentTypeId=="1"){if(document.getElementById("shipInstructions")!=null){this.updateParamObject(params,"shipInstructions","",false);document.getElementById("shipInstructions").value="";}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"addressId",addressId,false);this.updateParamObject(params,"orderItemId",orderItemId,false);}else{if(this.shipmentTypeId=="2"){if(suffix!=null&&suffix!=""){if(document.getElementById("MS_shipInstructions_"+suffix)!=null){this.updateParamObject(params,"shipInstructions","",false);document.getElementById("MS_shipInstructions_"+suffix).value="";}this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"orderItemId",suffix,false);this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,"");}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");}}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);}},initializeShipmentPage:function(shipmentTypeId){this.shipmentTypeId=shipmentTypeId;},setCommonParameters:function(langId,storeId,catalogId){this.langId=langId;this.storeId=storeId;this.catalogId=catalogId;},deleteFromCart:function(orderItemId,forWishlist){if(!this.isAjaxCheckOut()){return;}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=(this.orderId!=null&&this.orderId!="undefined"&&this.orderId!="")?this.orderId:".";params.orderItemId=orderItemId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.invCheck="false";params.updateESPQuantity="true";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}var x=document.getElementById("totalNumberOfItems").value;var y=x;for(var i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));if(qtyObj!=null||qtyObj!=undefined){qty=qtyObj.value;if(qty!=null&&qty!=undefined&&qty==-1){y=y-1;}}}if(!submitRequest()){return;}cursor_wait();if(typeof gtmHelper!="undefined"){gtmHelper.sendDeleteFromCart(orderItemId);}if(y==1){wc.service.invoke("AjaxDeleteOrderItem1",params);}else{if(forWishlist){wc.service.invoke("AjaxDeleteOrderItemFromCart",params);}else{if(this.shoppingCartPage||this.pendingOrderDetailsPage){wc.service.invoke("AjaxDeleteOrderItem",params);}else{wc.service.invoke("AjaxDeleteOrderItemForShippingBillingPage",params);}}}},addToWishListAndDeleteFromCart:function(catEntryIdentifier,orderItemId){if(!this.isAjaxCheckOut()){return;}var params=[];params.catEntryId=catEntryIdentifier;params.URL="SuccessfulAJAXRequest";params.orderItemId=orderItemId;params.updateable=0;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxInterestItemAddAndDeleteFromCart",params);},Add2WishListAjaxByID:function(catalogEntryId){if(catalogEntryId!=null){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.catEntryId=catalogEntryId;params.updateable=0;params.URL="SuccessfulAJAXRequest";if(document.getElementById("controllerURLWishlist")!=null&&document.getElementById("controllerURLWishlist")!="undefined"){CommonControllersDeclarationJS.setControllerURL("ShopCartDisplayController",document.getElementById("controllerURLWishlist").value);}if(!submitRequest()){return;}cursor_wait();if(this.ajaxShopCart){wc.service.invoke("AjaxInterestItemAdd",params);}else{wc.service.invoke("AjaxInterestItemAdd_shopCart",params);}}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERR_RESOLVING_SKU);}},updateAddressIdOFItemsOnCreateEditAddress:function(addressId){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var orderItemId=null;for(var i=0;i<this.orderItemIds.length;i++){orderItemId=this.orderItemIds[i];this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItemsAddressId",params);},updateAddressIdOfAddressInDropdown:function(addressBox,oldAddressId,newAddressId){if(!addressBox){return;}for(var i=0;i<addressBox.options.length;i++){if(addressBox.options[i].value==oldAddressId){addressBox.options[i].value=newAddressId;break;}}},saveOrderItemsList:function(orderItemId,addressId){if(orderItemId=="-1"){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(!document.getElementById("freeGift_qty_"+(i+1))){this.orderItemIds[i]=document.getElementById("orderItem_"+(i+1)).value;}}}else{if(orderItemId==0&&this.shipmentTypeId=="1"){if(document.getElementById("singleShipmentAddress")){if(addressId==document.getElementById("singleShipmentAddress").value){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(!document.getElementById("freeGift_qty_"+(i+1))){this.orderItemIds[i]=document.getElementById("orderItem_"+(i+1)).value;}}}else{this.orderItemIds=[];}}else{this.orderItemIds=[];}return;}else{var totalItems=document.getElementById("totalNumberOfItems").value;var temp=null;var orderItemId=null;var j=0;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(!document.getElementById("freeGift_qty_"+(i+1))){if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){temp=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(temp==addressId){this.orderItemIds[j++]=orderItemId;}}}}}}},setShippingInstuctionsForAllOtherItems:function(addressId,shipModeId,shipInstructions){var orderItemId,addressId1,shipModeId1="";var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){orderItemId=document.getElementById("orderItem_"+(i+1)).value;addressId1=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;shipModeId1=document.getElementById("MS_ShippingMode_"+orderItemId).value;if(shipModeId1==shipModeId&&addressId1==addressId){document.getElementById("MS_shipInstructions_"+orderItemId).value=shipInstructions;}}}},shipAsComplete:function(checkBox){if(!this.isAjaxCheckOut()){return;}var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(checkBox.checked){this.updateParamObject(params,"ShipAsComplete","Y",true);}else{this.updateParamObject(params,"ShipAsComplete","N",true);}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateAddressIdForOrderItem:function(addressId){if(addressId==null||addressId.length==0){return true;}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"addressId",addressId,false);wc.service.invoke("AjaxSetAddressIdOfOrderItems",params);},updateShipModeIdForOrder:function(shipModeId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.shipModeId=shipModeId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";wc.service.invoke("AjaxSetShipModeIdForOrder",params);},applyPromotionCode:function(formName,returnView,isUpper){var form=document.forms[formName];if(isUpper=="true"){form.promoCode.value=form.promoCode.value.toUpperCase();}if(trim(form.promoCode.value)==""){MessageHelper.formErrorHandleClient(form.promoCode.id,MessageHelper.messages.PROMOTION_CODE_EMPTY);return;}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(form.URL!=null){form.URL.value="";}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage");}else{if(returnView==null||returnView==""||returnView=="undefined"){returnView="OrderShippingBillingView";}var input=document.createElement("INPUT");input.setAttribute("type","hidden");input.setAttribute("name","errorViewName");input.setAttribute("value",returnView);form.appendChild(input);form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;if(!submitRequest()){return;}form.submit();}},removePromotionCode:function(formName,promoCode,returnView){var form=document.forms[formName];form.taskType.value="R";form.promoCode.value=promoCode;if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage");}else{if(returnView==null||returnView==""||returnView=="undefined"){returnView="OrderShippingBillingView";}form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;if(!submitRequest()){return;}form.submit();}},applyCoupon:function(formName,returnView,couponId){var form=document.forms[formName];form.couponId.value=couponId;form.taskType.value="A";if(!submitRequest()){return;}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxCouponsAddRemove");service.formId=formName;cursor_wait();wc.service.invoke("AjaxCouponsAddRemove");}else{form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;form.submit();}},removeCouponFromOrder:function(formName,returnView,couponId){var form=document.forms[formName];form.couponId.value=couponId;form.taskType.value="R";if(!submitRequest()){return;}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxCouponsAddRemove");service.formId=formName;cursor_wait();wc.service.invoke("AjaxCouponsAddRemove");}else{form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;form.submit();}},setAjaxCheckOut:function(ajaxCheckOut){this.ajaxCheckOut=ajaxCheckOut;},isAjaxCheckOut:function(){return this.ajaxCheckOut;},setSinglePageCheckout:function(singlePageCheckout){this.singlePageCheckout=singlePageCheckout;},isSinglePageCheckout:function(){return this.singlePageCheckout;},checkoutOrder:function(orderId,paymentType,userType,addressListForMailNotification,isQuote){if(isQuote==undefined||isQuote==null){isQuote=false;}params=[];params.orderId=orderId;params.notifyMerchant=1;params.notifyShopper=1;params.notifyOrderSubmitted=1;params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.payInfoCVV=CheckoutPayments.getCVVFromCookie("PAYINFO_CVV");var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if(purchaseOrderForm.purchaseOrderNumberRequired.value=="true"&&purchaseOrderForm.purchase_order_number.value==""){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);return;}else{if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128)){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);return;}}}params.purchaseorder_id=purchaseOrderNumber;if(userType=="G"){addressListForMailNotification=trim(addressListForMailNotification);var emailList=[];emailList=addressListForMailNotification.split(" ");var uniqueList=[];for(var j=0;j<emailList.length;j++){uniqueList[emailList[j]]=emailList[j];}var totalLength=0;for(i in uniqueList){totalLength=totalLength+1;}var temp="";var k=0;for(i in uniqueList){k=k+1;temp=temp+uniqueList[i];if(k<totalLength){temp=temp+",";}}params.notify_EMailSender_recipient=temp;var smsOrderNotificationCheckbox=document.getElementById("sendMeSMSNotification");if(smsOrderNotificationCheckbox!=null&&smsOrderNotificationCheckbox!="undefined"){if(smsOrderNotificationCheckbox.checked){var mobileCountryCode=document.getElementById("mobileCountryCode");var mobilePhone1=document.getElementById("mobilePhone1");if(mobileCountryCode!=null&&mobileCountryCode!="undefined"&&mobilePhone1!=null&&mobilePhone1!="undefined"){params.SMS=mobileCountryCode.value+mobilePhone1.value;}}}}if(!submitRequest()){return;}cursor_wait();if(paymentType=="PP"){CardinalServicesDeclarationJS.setCheckoutParameters(params,isQuote);wc.service.invoke("AjaxCardinalOrder",params);}else{if(!isQuote){wc.service.invoke("AjaxSubmitOrder",params);}else{params.URL="";this.setOrderId(orderId);wc.service.invoke("AjaxSubmitQuote",params);}}},prepareOrderSchedule:function(){if(document.getElementById("scheduleOrderInputSection")!=null){var scheduleOrderStartDateObj=dijit.byId("ScheduleOrderStartDate");if(!this.validateDate(scheduleOrderStartDateObj,"ScheduleOrderStartDate")){return;}var interval=document.getElementById("ScheduleOrderFrequency").value;var key1="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_strStartDate";var key2="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_interval";if((interval=="undefined")&&(scheduleOrderStartDateObj.value==null)){dojo.cookie(key1,null,{expires:-1});dojo.cookie(key2,null,{expires:-1});}else{var t=dojo.date.stamp.fromISOString(scheduleOrderStartDateObj);var now=new Date();t.setHours(now.getHours(),now.getMinutes(),now.getSeconds(),now.getMilliseconds());t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});dojo.cookie(key1,t);dojo.cookie(key2,interval);}}},scheduleOrder:function(orderId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=orderId;params.strStartDate=dojo.cookie("WC_ScheduleOrder_"+orderId+"_strStartDate");params.interval=dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval");var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if(purchaseOrderForm.purchaseOrderNumberRequired.value=="true"&&purchaseOrderForm.purchase_order_number.value==""){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);return;}else{if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128)){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);return;}}params.purchaseorder_id=purchaseOrderNumber;}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("ScheduleOrder",params);},validateDate:function(dateObj,elementId){var now=new Date();if(dateObj.getValue()!=null&&(dateObj.compare(dateObj.getValue(),now)<0)){var interval=document.getElementById("ScheduleOrderFrequency").value;if(interval==""){if(now.toDateString()==dateObj.getValue().toDateString()){return true;}}if((elementId!=null)&&(document.getElementById(elementId)!=null)){MessageHelper.formErrorHandleClient(document.getElementById(elementId).id,MessageHelper.messages.PAST_DATE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.PAST_DATE_ERROR);}return false;}else{return true;}},createAddress:function(orderItemId,addressType){this.saveOrderItemsList(orderItemId,"-1");if(!submitRequest()){return;}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType});this.showHideDivs("editAddressContents","mainContents");},showHideDivs:function(showArea,hideArea){document.getElementById(hideArea).style.display="none";document.getElementById(showArea).style.display="block";},restorePreviousAddressDetails:function(){var valueRestored=false;if(!this.isAjaxCheckOut()){for(i in this.selectedAddressesArray){if(document.getElementById(i).value==-1){document.getElementById(i).value=this.selectedAddressesArray[i];valueRestored=true;if(this.shipmentTypeId=="1"){this.displayAddressDetails(document.getElementById("singleShipmentAddress").value,"Shipping");}}}}if(this.isAjaxCheckOut()||!valueRestored){if(this.shipmentTypeId=="2"){for(var i=0;i<this.orderItemIds.length;i++){var orderItemId=this.orderItemIds[i];var element=document.getElementById("MS_ShipmentAddress_"+orderItemId);if(element!=null&&element.value==-1){element.value=document.getElementById("addressId_"+orderItemId).value;}}}else{if(this.shipmentTypeId=="1"){var element=document.getElementById("singleShipmentAddress");if(element!=null&&document.getElementById("addressId_all")){element.value=document.getElementById("addressId_all").value;if(!this.isAjaxCheckOut()){this.displayAddressDetails(element.value,"Shipping");}}}}}for(var i=1;i<4;i++){if(document.getElementById("PaymentForm"+i)!=null){var paymentForm=document.getElementById("PaymentForm"+i);if(paymentForm.billing_address_id.value==-1){paymentForm.billing_address_id.value=document.getElementById("selectedAddressId_"+i).value;if(!this.isAjaxCheckOut()){CheckoutPayments.displayBillingAddressDetailsWeb10(paymentForm.billing_address_id,i);}}}}},editAddress:function(addressSelectBoxName,orderItemId,profileshipping,profilebilling){var addressBox=document.getElementById(addressSelectBoxName);this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressSelectBoxName!=null){MessageHelper.formErrorHandleClient(addressSelectBoxName,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}return;}if(!submitRequest()){return;}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value,addressBox:addressBox});this.showHideDivs("editAddressContents","mainContents");},editBillingAddress:function(orderItemId,paymentArea,profileshipping,profilebilling){var form=document.forms["PaymentForm"+paymentArea];var addressBox=form.billing_address_id;this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressBox!=null){MessageHelper.formErrorHandleClient(addressBox,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE);}return;}if(!submitRequest()){return;}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value,addressBox:addressBox});this.showHideDivs("editAddressContents","mainContents");},cancelEditAddress:function(){this.showHideDivs("mainContents","editAddressContents");this.restorePreviousAddressDetails();},getShipmentTypeId:function(){return this.shipmentTypeId;},paymentDataDirty:function(paymentAreaNumber,flag){this.dataDirty[paymentAreaNumber]=flag;console.debug("Information in payment area "+paymentAreaNumber+" has been modified.");},isPaymentDataDirty:function(paymentAreaNumber){return this.dataDirty[paymentAreaNumber];},displayStoreAddressDetails:function(addressSelectBox){var selectedAddressId=addressSelectBox.value;for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block";}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none";}}},updateStoreAddressForAllItems:function(addressSelectBox){if(!this.isAjaxCheckOut()){return;}var addressId=addressSelectBox.value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var orderItemId=null;var totalItems=document.getElementById("totalNumberOfItems").value;var addressId=document.getElementById("singleShipmentAddress").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"physicalStoreId",addressId,false,-1);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},updateShippingModeAndAddressForOrderItem:function(shippingModeSelectBox,orderItemId,pickUpInStoreShipMode){if(!this.isAjaxCheckOut()){return;}var selectedShippingMode=shippingModeSelectBox.value;if(pickUpInStoreShipMode==selectedShippingMode){document.getElementById("MS_ShipMode_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_StoreAddress_Section_"+orderItemId).className="";}else{document.getElementById("MS_ShipMode_Section_"+orderItemId).className="";document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="";document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="";document.getElementById("MS_StoreAddress_Section_"+orderItemId).className="nodisplay";}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.orderItemId=orderItemId;params.shipModeId=selectedShippingMode;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(pickUpInStoreShipMode==selectedShippingMode){var physicalStoreId=document.getElementById("MS_StoreSelectBox_"+orderItemId).value;params.physicalStoreId=physicalStoreId;}else{if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params.addressId=addressId;}}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},updateStoreAddressForOrderItem:function(storeAddressSelectBox,orderItemId){if(!this.isAjaxCheckOut()){return;}var selectedPickUpStoreId=storeAddressSelectBox.value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.orderItemId=orderItemId;params.physicalStoreId=selectedPickUpStoreId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},setFieldDirtyFlag:function(value){this.fieldDirtyFlag=value;},getFieldDirtyFlag:function(){return this.fieldDirtyFlag;},checkForDirtyFlag:function(){if(this.getFieldDirtyFlag()){if(document.getElementById("ShoppingCart_NonAjaxUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("ShoppingCart_NonAjaxUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST_SHOPPING_CART);return true;}else{if(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST);return true;}else{if(document.getElementById("SingleShipment_NonAjaxShipInfoUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("SingleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST);return true;}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_UPDATE_FIRST);return true;}}}}return false;},showHideCheckoutSMS:function(checkboxElementId,smsElementId){var smsOrderNotificationCheckbox=document.getElementById(checkboxElementId);if(smsOrderNotificationCheckbox!=null&&smsOrderNotificationCheckbox!="undefined"){if(smsOrderNotificationCheckbox.checked){showElementById(smsElementId);}else{hideElementById(smsElementId);}}},getCountryArray:function(){if(document.countries==null){countries=new Array();var theDiv=document.getElementById("countryListSelectionHelper");if(typeof theDiv=="undefined"){return null;}var divJSON=eval("("+theDiv.innerHTML+")");var countriesObject=divJSON.countries;for(var i=0;i<countriesObject.length;i++){var countryObject=countriesObject[i];countries[countryObject.code]=new Object();countries[countryObject.code].name=countryObject.displayName;countries[countryObject.code].countryCallingCode=countryObject.callingCode;if(countryObject.states.length>0){countries[countryObject.code].states=new Object();for(var j=0;j<countryObject.states.length;j++){var state=countryObject.states[j];countries[countryObject.code].states[state.code]=state.displayName;}}}}return countries;},loadCountryCode:function(countryDropDownId,countryCallingCodeId){this.getCountryArray();var countryCode=document.getElementById(countryDropDownId).value;document.getElementById(countryCallingCodeId).value=countries[countryCode].countryCallingCode;},expediteShipping:function(checkBox,inputOrderItemId){if(!this.isAjaxCheckOut()){return;}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;if(checkBox.checked){this.updateParamObject(params,"isExpedited","Y",true);}else{this.updateParamObject(params,"isExpedited","N",true);}if(inputOrderItemId!=null){this.updateParamObject(params,"orderItemId",inputOrderItemId,false);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateCartWait:function(quantityBox,orderItemId,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateCart",quantityBox,orderItemId,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateCart:function(quantityBox,orderItemId,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var quantity=(quantityBox.value);if(!isNonNegativeInteger(quantity)){MessageHelper.formErrorHandleClient(quantityBox,MessageHelper.messages.QUANTITY_INPUT_ERROR);}else{var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"quantity",quantity,false,-1);params.updateESPQuantity="true";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}if(!submitRequest()){return;}cursor_wait();if(typeof gtmHelper!="undefined"){gtmHelper.sendCartQuantityUpdated(orderItemId);}wc.service.invoke("AjaxUpdateOrderItem",params);}},updateServiceOptionsWait:function(additionalSKUElement,orderItemId,skuType,currentSKUs,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}if(skuType!=1&&skuType!=2&&skuType!=3){return;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateServiceOptions",additionalSKUElement,orderItemId,skuType,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateServiceOptions:function(additionalSKUElement,orderItemId,skuType,currentSKUs,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var additionalSKU=(additionalSKUElement.value);var servicesArray=[];servicesArray=currentSKUs.toString().split("_");var newSKUs;if(skuType==1){}else{if(skuType==2){newSKUs=servicesArray[0]+"_"+additionalSKU+"_";}else{newSKUs=servicesArray[0]+"_";if(!isNaN(servicesArray[1])){newSKUs=newSKUs+servicesArray[1];}newSKUs=newSKUs+"_";}}var optSrvIndex=1;var productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);while(productElement!=null){if(productElement!=null){if(productElement.checked){newSKUs=newSKUs+productElement.value+"_";}}else{break;}optSrvIndex++;productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);}var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"comment",newSKUs,false,-1);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},initDojoEventListenerShoppingCartPage:function(){if(document.getElementById("totalNumberOfItems")!=null){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){for(var i=0;i<totalItems;i++){var object=dojo.byId("quantity_"+(i+1));if(object!=null){dojo.connect(object,"onchange",setDirtyFlag);}}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}}},updateShoppingCart:function(form,validateQuantityOnly){if(validateQuantityOnly!=undefined&&validateQuantityOnly==true&&!this.isAjaxCheckOut()){return true;}MessageHelper.hideAndClearMessage();var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null){for(var i=0;i<totalItems;i++){if(form!=undefined){var quantity=null;quantity=form["quantity_"+(i+1)];}else{var quantity=dojo.byId("qty_"+(i+1));}if(quantity!=null||quantity!=undefined){var v=quantity.value;if(!isNonNegativeInteger(v)){MessageHelper.formErrorHandleClient(quantity.id,MessageHelper.messages.QUANTITY_INPUT_ERROR);return;}else{if(v>parseInt(MessageHelper.messages.MAX_ORDERITEM_QTY)){MessageHelper.formErrorHandleClient(quantity.id,MessageHelper.messages.ERR_MAX_ORDERITEM_QTY);return;}}}}if(document.getElementById("MS_giftMessage")){var giftMessage=document.getElementById("MS_giftMessage").value;if(giftMessage.length>this.giftMessageMaxLength){MessageHelper.formErrorHandleClient("MS_giftMessage",MessageHelper.messages.ERROR_MAXIMUM_GIFT_MESSAGE_LENGTH);return;}}if(validateQuantityOnly!=undefined&&validateQuantityOnly==true){return true;}if(!submitRequest()){return;}var beginIndex=wc.render.getContextById("ShopCartPaginationDisplay_Context").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0;}form.URL.value=form.URL.value+"&beginIndex="+beginIndex;form.submit();this.setFieldDirtyFlag(false);}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}},updateCartWithQuickCheckoutProfile:function(quickOrderId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.toOrderId=".";params.shippingAddressFromOrderProfile="1";params.shippingModeFromOrderProfile="1";params.URL="dummy";params.payInfoFrom=quickOrderId;params.orderInfoFrom=quickOrderId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.calculateOrder="1";params.quickCheckout="true";wc.service.declare({id:"QuickCheckOutOrderCopy",actionId:"QuickCheckOutOrderCopy",url:"AjaxOrderCopy",successHandler:function(serviceResponse){cursor_clear();document.location.href="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL=OrderShippingBillingView?langId="+CheckoutHelperJS.langId+"&storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&quickCheckoutProfileForPayment=true&chkSAPInvFlg=false";},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}cursor_clear();}});if(!submitRequest()){return;}cursor_wait();wc.service.invoke("QuickCheckOutOrderCopy",params);},addNewShippingAddress:function(addressType){this.displayAddressDetails(-1,addressType);},updateAddressForAllItems:function(addressSelectBox){if(addressSelectBox.value!=-1){this.selectedAddressesArray[addressSelectBox.name]=addressSelectBox.value;}if(!this.isAjaxCheckOut()){return;}var addressId=addressSelectBox.value;if(addressId==-1){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var addressId=document.getElementById("singleShipmentAddress").value;this.updateParamObject(params,"addressId",addressId,false);var enabledShipInstructions=false;var shipInstructions;if(document.getElementById("shipInstructions")!=null){shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions="";}enabledShipInstructions=true;}if(!submitRequest()){return;}cursor_wait();if(!enabledShipInstructions||shipInstructions==undefined||shipInstructions==""){wc.service.invoke("OrderItemAddressShipMethodUpdate",params);}else{wc.service.invoke("OrderItemAddressShipInstructionsUpdate",params);}},updateShipModeForAllItems:function(shipmentSelectBox){if(!this.isAjaxCheckOut()){return;}var shipModeId=shipmentSelectBox.value;if(shipModeId==-1){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"shipModeId",shipModeId,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateShippingInstructionsForAllItems:function(){if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;var shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions="";}if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);this.updateParamObject(params,"shipInstructions",shipInstructions,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateShippingChargeForShipModeAjax:function(curOrderId,shipModeId,shipChargeType,shipAcctNum){if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=curOrderId;params.URL="";params.shipModeId=shipModeId;params.shipChargTypeId=shipChargeType;if(shipAcctNum!=null&&shipAcctNum!=undefined){params.shipCarrAccntNum=shipAcctNum;}else{params.shipCarrAccntNum="";}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxOrderShipChargeUpdate",params);},updateShippingChargeForShipMode:function(myForm){if(this.isAjaxCheckOut()){return;}myForm.URL.value="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL=OrderShippingBillingView?forceShipmentType=2";myForm.submit();},hideShipChargeAccountField:function(selectValue,acctFieldId){if(document.getElementById(selectValue).value.indexOf("ByCarrier")>-1){document.getElementById(acctFieldId).style.display="block";}else{document.getElementById(acctFieldId).style.display="none";}},updateRequestedShipDate:function(jsDate){if(jsDate==null||jsDate.getDisplayedValue()==null){return;}var now=new Date();if(jsDate.compare(jsDate.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}if(!this.isAjaxCheckOut()){return;}var t="";if(jsDate.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDate);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDate.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}jsDate._close();this.updateShippingDateForAllItems(t);},updateShippingDateForAllItems:function(date){params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"requestedShipDate",date,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},displayAddressDetails:function(addressSelectBoxValue,addressType){if(!this.isAjaxCheckOut()){this.displayAddressDetailsWeb10(addressSelectBoxValue,addressType);}else{if(addressSelectBoxValue!=-1){if(!submitRequest()){return;}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("shippingAddressContext",{shippingAddress:addressSelectBoxValue});}else{this.createAddress(-1,addressType);}}},displayAddressDetailsWeb10:function(addressSelectBoxValue,addressType){var selectedAddressId=addressSelectBoxValue;var addressSelectBox=dojo.byId("singleShipmentAddress");for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block";}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none";}}if(selectedAddressId==-1){this.createAddress(-1,addressType);}},initDojoEventListenerSingleShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){if(dojo.byId("singleShipmentAddress")!=null){dojo.connect(dojo.byId("singleShipmentAddress"),"onchange",setDirtyFlag);}if(dojo.byId("WC_ShippingAddressSelectSingle_div_2")!=null){dojo.connect(dojo.byId("WC_ShippingAddressSelectSingle_div_2"),"onclick",setDirtyFlag);}if(dojo.byId("singleShipmentShippingMode")!=null){dojo.connect(dojo.byId("singleShipmentShippingMode"),"onchange",setDirtyFlag);}if(dojo.byId("shipAsComplete")!=null){dojo.connect(dojo.byId("shipAsComplete"),"onclick",setDirtyFlag);}if(dojo.byId("shippingInstructionsCheckbox")!=null){dojo.connect(dojo.byId("shippingInstructionsCheckbox"),"onclick",setDirtyFlag);}if(dojo.byId("requestShippingDateCheckbox")!=null){dojo.connect(dojo.byId("requestShippingDateCheckbox"),"onclick",setDirtyFlag);}if(dojo.byId("shipInstructions")!=null){dojo.connect(dojo.byId("shipInstructions"),"onchange",setDirtyFlag);}if(dojo.byId("expediteShipping")!=null){dojo.connect(dojo.byId("expediteShipping"),"onchange",setDirtyFlag);}if(dojo.byId("expediteShipping_1")!=null){for(var i=0;i<totalItems;i++){if(dojo.byId("qty_"+(i+1)).value!="-1"){var object=dojo.byId("expediteShipping_"+(i+1));dojo.connect(object,"onchange",setDirtyFlag);}}}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}},updateSingleShipmentShoppingCart:function(form){var formAction="OrderChangeServiceShipInfoUpdate?";var updateShippingURL="OrderChangeServiceShipInfoUpdate?";var instructions=null;var t=null;if(dojo.byId("shippingInstructionsCheckbox")!=null){if(dojo.byId("shippingInstructionsCheckbox").checked){if(document.getElementById("shipInstructions")!=null&&document.getElementById("shipInstructions").value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("shipInstructions").value,4000)){instructions=document.getElementById("shipInstructions").value;}else{MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}}}else{if(document.getElementById("shipInstructions")!=null){instructions="";}}}if(dojo.byId("requestShippingDateCheckbox")!=null){var jsDateObj=dijit.byId("requestedShippingDate");if(dojo.byId("requestShippingDateCheckbox").checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue;}}}if(document.getElementById("singleShipmentAddress").value!=-1){updateShippingURL=updateShippingURL+"addressId="+document.getElementById("singleShipmentAddress").value;}else{MessageHelper.formErrorHandleClient(document.getElementById("singleShipmentAddress").id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);return;}formAction=formAction+"shipModeId="+document.getElementById("singleShipmentShippingMode").value;if(this.shipChargeEnabled){formAction=formAction+"&shippingChargeType="+document.getElementById("shipChargTypeId_1").value;formAction=formAction+"&shipCarrAccntNum="+document.getElementById("shipCarrAccntNum_1").value;}var shipInstructions="";if(instructions!=null){shipInstructions="shipInstructions%3D"+instructions+"%26orderItemId_1%3D"+document.getElementById("orderItem_1").value;}if(t!=null){formAction=formAction+"&requestedShipDate="+t;}var checkBox=document.getElementById("shipAsComplete");if(checkBox.checked){formAction=formAction+"&ShipAsComplete=Y";}else{formAction=formAction+"&ShipAsComplete=N";}if(document.getElementById("expediteShipping_1")!=null){var totalNumberOfItemsOnPage=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalNumberOfItemsOnPage;i++){if(document.getElementById("qty_"+(i+1)).value!="-1"){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId;}var object=document.getElementById("expediteShipping_"+(i+1));if(object.checked){document.getElementById("isExpedited_"+(i+1)).value="Y";}else{document.getElementById("isExpedited_"+(i+1)).value="N";}}}}form.action=formAction;var beginIndex=wc.render.getContextById("traditionalShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0;}form.URL.value=updateShippingURL+"&requestedShipDate*=&shipModeId*=&orderItemId*=&URL=OrderChangeServiceShipInfoUpdate%3F"+shipInstructions+"%26allocate%3D***%26backorder%3D***%26remerge%3D***%26check%3D*n%26URL%3DOrderShippingBillingView%3F%26beginIndex%3D"+beginIndex;if(!submitRequest()){return;}form.submit();},moveAllItemsToSingleShipment:function(){var orderItemId=document.getElementById("orderItem_1").value;var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"addressId",addressId,false);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate1",params);},addNewShippingAddressForMS:function(orderItemId){this.updateAddressIdForThisItem(-1,orderItemId);},updateAddressIdForThisItem:function(addressBoxValue,orderItemId){if(addressBoxValue!=-1){var addressBox=dojo.byId("MS_ShipmentAddress_"+orderItemId);this.selectedAddressesArray[addressBox.name]=addressBoxValue;}if(addressBoxValue==-1){return;}if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var addressId=addressBoxValue;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateShipModeForThisItem:function(shipModeBox,orderItemId){var shipModeId=shipModeBox.value;if(shipModeId==-1){return;}if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateShippingInstructionsForThisItem:function(textArea,orderItemId){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;var shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;var shipInstructions=textArea.value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions="";}if(this.isAjaxCheckOut()){if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(textArea.id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}}this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,shipInstructions);if(!this.isAjaxCheckOut()){return;}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);this.updateParamObject(params,"shipInstructions",shipInstructions,false,-1);this.updateParamObject(params,"orderItemId",orderItemId,false,-1);if(!submitRequest()){return;}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params);},updateRequestedShipDateForThisItem:function(jsDate,orderItemId,shippingCondition,invokeSAP){if(jsDate==null||jsDate.getDisplayedValue()==null){return;}var now=new Date();if(jsDate.compare(jsDate.getValue(),now)<=0){if(document.getElementById("MS_requestedShippingDate_"+orderItemId)!=null){MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}if(!this.isAjaxCheckOut()){return;}var t="";if(jsDate.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDate);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDate.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}jsDate._close();var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;var shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"requestedShipDate",t,false,-1);params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";params.addressId=addressId;if(!submitRequest()){return;}cursor_wait();CheckoutHelperJS.RequestShippingDateAction=true;wc.service.declare({id:"reserveDeliveryApptDates",actionId:"reserveDeliveryApptDates",url:"AjaxReserveDeliveryApptDates",formId:"",successHandler:function(serviceResponse){params.apptRefNum=serviceResponse.apptRefNum;wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}wc.service.invoke("OrderItemAddressShipMethodUpdate",params);}});cursor_wait();wc.service.invoke("reserveDeliveryApptDates",{storeId:storeId,catalogId:catalogId,langId:langId,orderItemId:orderItemId,addressId:addressId,appointmentDate:t,shippingCondition:shippingCondition,invokeSAP:invokeSAP});},createAddressForMS:function(orderItemId,addressType){this.saveOrderItemsList(orderItemId,"-1");if(!submitRequest()){return;}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType});this.showHideDivs("editAddressContents","mainContents");},displayAddressDetailsForMSHelper:function(orderItemId,addressType){this.displayAddressDetailsForMS(-1,orderItemId,addressType);},displayAddressDetailsForMS:function(addressSelectBoxValue,orderItemId,addressType){if(this.isAjaxCheckOut()){if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}}else{if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}else{dojo.byId("MS_shippingAddressDisplayArea_"+orderItemId).innerHTML=dojo.byId("addressDetails_"+addressSelectBoxValue).innerHTML;}}},initDojoEventListenerMultiShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){var list_clickable=new dojox.collections.ArrayList([]);var list_editable=new dojox.collections.ArrayList([]);for(var i=0;i<totalItems;i++){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;var object="";if(orderItemId!=null){object=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(object!=null){list_clickable.add(object);}object=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(object!=null){list_clickable.add(object);}object=dojo.byId("shipAsComplete");if(object!=null){list_clickable.add(object);}object=dojo.byId("editAddressButton");if(object!=null){list_clickable.add(object);}object=dojo.byId("MS_expediteShipping_"+orderItemId);if(object!=null){list_clickable.add(object);}object=dojo.byId("MS_ShipmentAddress_"+orderItemId);if(object!=null){list_editable.add(object);}object=dojo.byId("MS_ShippingMode_"+orderItemId);if(object!=null){list_editable.add(object);}object=dojo.byId("MS_shipInstructions_"+orderItemId);if(object!=null){list_editable.add(object);}object=dojo.byId("qty_"+(i+1));if(object!=null){list_editable.add(object);}}else{var j=i+1;console.debug("error: element 'orderItem_'"+j+" was expected but undefined.");}}for(var i=0;i<list_clickable.count;i++){var item=list_clickable.item(i);dojo.connect(item,"onclick",setDirtyFlag);}for(var i=0;i<list_editable.count;i++){var item=list_editable.item(i);dojo.connect(item,"onchange",setDirtyFlag);}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return;}},updateMultiShipmentShoppingCart:function(form){var updateShippingAction="OrderChangeServiceShipInfoUpdate";var updateShippingURL="OrderShippingBillingView?";var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId;}var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(addressId!=-1){if(document.getElementById("addressId_"+(i+1))!=null){document.getElementById("addressId_"+(i+1)).value=addressId;}}else{MessageHelper.formErrorHandleClient(document.getElementById("MS_ShipmentAddress_"+orderItemId).id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);return;}if(form.elements["shipModeId_"+(i+1)]!=null){form.elements["shipModeId_"+(i+1)].value=document.getElementById("MS_ShippingMode_"+orderItemId).value;}var instructions=null;var t=null;var shippingInstructionsCheckbox=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(shippingInstructionsCheckbox!=null){if(shippingInstructionsCheckbox.checked){if(document.getElementById("MS_shipInstructions_"+orderItemId)!=null&&document.getElementById("MS_shipInstructions_"+orderItemId).value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("MS_shipInstructions_"+orderItemId).value,4000)){instructions=document.getElementById("MS_shipInstructions_"+orderItemId).value;}else{MessageHelper.formErrorHandleClient(document.getElementById("MS_shipInstructions_"+orderItemId).id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return;}}}else{if(document.getElementById("MS_shipInstructions_"+orderItemId)!=null){instructions="";}}}var requestShippingDateCheckbox=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(requestShippingDateCheckbox!=null){t=this.resetRequestedShipDateValue;var jsDateObj=dijit.byId("MS_requestedShippingDate_"+orderItemId);if(requestShippingDateCheckbox.checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("MS_requestedShippingDate_"+orderItemId)!=null){MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);}return;}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue;}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue;}}}if(instructions!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("shipInstructions_"+(i+1))!=null){document.getElementById("shipInstructions_"+(i+1)).value=instructions;}}}if(t!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("requestedShipDate_"+(i+1))!=null){document.getElementById("requestedShipDate_"+(i+1)).value=t;}}}if(document.getElementById("MS_expediteShipping_"+orderItemId)!=null&&document.getElementById("isExpedited_"+(i+1))!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("MS_expediteShipping_"+orderItemId).checked){document.getElementById("isExpedited_"+(i+1)).value="Y";}else{document.getElementById("isExpedited_"+(i+1)).value="N";}}}}var checkBox=document.getElementById("shipAsComplete");if(document.getElementById("ShipAsComplete")!=null){if(checkBox.checked){document.getElementById("ShipAsComplete").value="Y";}else{document.getElementById("ShipAsComplete").value="N";}}updateShippingURL=updateShippingURL+"orderItemId*=";updateShippingURL=updateShippingURL+"&quantity*=";updateShippingURL=updateShippingURL+"&addressId*=";updateShippingURL=updateShippingURL+"&shipModeId*=";updateShippingURL=updateShippingURL+"&shipInstructions*=";updateShippingURL=updateShippingURL+"&requestedShipDate*=";updateShippingURL=updateShippingURL+"&isExpedited*=";updateShippingURL=updateShippingURL+"&ShipAsComplete*=";updateShippingURL=updateShippingURL+"&orderItem*=";updateShippingURL=updateShippingURL+"&MS_ShipmentAddress*=";updateShippingURL=updateShippingURL+"&MS_ShippingMode*=";updateShippingURL=updateShippingURL+"&MS_shippingInstructionsCheckbox*=";updateShippingURL=updateShippingURL+"&MS_shipInstructions*=";updateShippingURL=updateShippingURL+"&MS_requestShippingDateCheckbox*=";updateShippingURL=updateShippingURL+"&MS_requestedShippingDate*=";updateShippingURL=updateShippingURL+"&MS_expediteShipping*=";updateShippingURL=updateShippingURL+"&qty*=";updateShippingURL=updateShippingURL+"&shipAsComplete*=";var beginIndex=wc.render.getContextById("multipleShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0;}updateShippingURL=updateShippingURL+"&beginIndex="+beginIndex;form.action=updateShippingAction;form.URL.value=updateShippingURL;if(!submitRequest()){return;}form.submit();},showHideEditAddressLink:function(addressSelectBox,orderItemId){var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editAddressLink_"+orderItemId).style.display="none";break;}else{dojo.byId("editAddressLink_"+orderItemId).style.display="block";}}}}else{if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){dojo.byId("editAddressLink_"+orderItemId).style.display="block";}}},showHideEditBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if(addressSelectBox.value=="-2"){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";return;}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break;}else{dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block";}}}}else{if(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";}}},setOrderId:function(orderId){this.orderId=orderId;},getOrderId:function(){return this.orderId;},showHideCreateBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if(addressSelectBox.value=="-2"){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";return;}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break;}else{dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block";}}}}else{if(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";}}},updateWHRAddressIdForThisItem:function(addressId){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var orderItemId=null;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItemsAddressId",params);},displayWHRAddressDetailsForMS:function(addressSelectBoxValue,orderItemId,addressType){if(this.isAjaxCheckOut()){if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}}else{if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType);}else{var orderItemId=null;var qty=null;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;dojo.byId("MS_shippingAddressDisplayArea_"+orderItemId).innerHTML=dojo.byId("addressDetails_"+addressSelectBoxValue).innerHTML;document.getElementById("MS_ShipmentAddress_"+orderItemId).value=addressSelectBox.value;}}}},updateWHRShipModeForThisItem:function(shipModeBox,currentffmCenterId,orderItemId){var shipModeId=shipModeBox.value;var shipModeText=shipModeBox.options[shipModeBox.selectedIndex].text;var willCall=false;if(shipModeText=="Will Call"){willCall=true;}if(shipModeId==-1){return;}var totalItems=document.getElementById("totalNumberOfItems").value;if(!this.isAjaxCheckOut()){return;}var ffmCenterId=null;var orderItemId=null;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";params.willCall=willCall;for(var i=0;i<totalItems;i++){ffmCenterId=document.getElementById("ffmCenter_"+(i+1)).value;orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(ffmCenterId==currentffmCenterId){document.getElementById("MS_ShippingMode_"+orderItemId).value=shipModeId;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);}}wc.service.invoke("OrderItemAddressShipMethodUpdate",params);},updateWHRServiceOptionsWait:function(additionalSKUElement,region,currentffmCenterId,orderItemId,currentIndex,skuType,currentSKUs,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}if(skuType!=1&&skuType!=2&&skuType!=3){return;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateWHRServiceOptions",additionalSKUElement,region,currentffmCenterId,orderItemId,currentIndex,skuType,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateWHRServiceOptions:function(additionalSKUElement,region,currentffmCenterId,orderItemId,currentIndex,skuType,currentSKUs,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var additionalSKU=(additionalSKUElement.value);var servicesArray=[];servicesArray=currentSKUs.toString().split("_");var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var newSKUs;if(skuType==1){if(additionalSKUElement.length==0){var clearGiftMessage=" ";var itemsChecked=0;$("#page.shoppingCartPage #order_details div #giftWrap input.checkbox").each(function(){if($(this).attr("checked")){itemsChecked++;}});if(itemsChecked==0){this.updateParamObject(params,"field3",clearGiftMessage,false);}newSKUs="_";}else{newSKUs=additionalSKUElement+"_";}if(servicesArray[1]!=undefined&&servicesArray[1].length>0){newSKUs=newSKUs+servicesArray[1]+"_";}for(i=2;i<servicesArray.length;i++){if(servicesArray[i].length>0){newSKUs=newSKUs+servicesArray[i]+"_";}}}else{if(skuType==2){newSKUs=servicesArray[0]+"_"+additionalSKU+"_";}else{newSKUs=servicesArray[0]+"_";var mandServiceChecked=false;var mandServiceOptionsId=dojo.query("input[id^='MandatoryServiceOptions_']");if(mandServiceOptionsId.some(function(field,i){var mandServiceOptionsFields=field.id.split("MandatoryServiceOptions_")[1];var itemId=orderItemId;var serviceId=mandServiceOptionsFields.split("_")[1];var radioButtonServicesName="MandatoryServiceOptions_"+itemId;var radioButtonServicesId="MandatoryServiceOptions_"+itemId+"_"+serviceId;var mandServOpt=document.getElementById(radioButtonServicesId);if(mandServOpt.checked){newSKUs=newSKUs+mandServOpt.value;mandServiceChecked=true;return true;}})){if(!isNaN(servicesArray[1])&&!mandServiceChecked){newSKUs=newSKUs+servicesArray[1];}}newSKUs=newSKUs+"_";}}var optSrvIndex=1;var productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);while(productElement!=null){if(productElement!=null){if(productElement.checked){newSKUs=newSKUs+productElement.value+"_";}}else{break;}optSrvIndex++;productElement=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+optSrvIndex);}var totalItems=document.getElementById("totalNumberOfItems").value;if(region=="NAR"){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"comment",newSKUs,false,-1);}else{if(region=="WER"){var ffmCenterId=null;var orderItemIdinFfmCenter=null;var mandatoryserviceChecked=null;var optionalserviceChecked=null;if(skuType==2){mandatoryserviceChecked=document.getElementById("MandatoryServiceOptions_"+orderItemId+"_"+currentIndex).checked;}else{if(skuType==3){optionalserviceChecked=document.getElementById("OptionalServiceOptions_"+orderItemId+"_"+currentIndex).checked;}}for(var i=0;i<totalItems;i++){ffmCenterId=document.getElementById("ffmCenter_"+(i+1)).value;orderItemIdinFfmCenter=document.getElementById("orderItem_"+(i+1)).value;if(ffmCenterId==currentffmCenterId){if(orderItemId!=orderItemIdinFfmCenter){if(skuType==2){dojo.byId("MandatoryServiceOptions_"+orderItemIdinFfmCenter+"_"+currentIndex).checked=mandatoryserviceChecked;}else{if(skuType==3){dojo.byId("OptionalServiceOptions_"+orderItemIdinFfmCenter+"_"+currentIndex).checked=optionalserviceChecked;}}}this.updateParamObject(params,"orderItemId",orderItemIdinFfmCenter,false,-1);this.updateParamObject(params,"comment",newSKUs,false,-1);}}}}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},toggleServiceOptionsDisplay:function(form,orderItemId,homeDeliveryId){var shipDropDown=document.getElementById("MS_ShippingMode_"+orderItemId);if(shipDropDown[shipDropDown.selectedIndex].value==homeDeliveryId){CheckoutHelperJS.showDiv("ServiceOptionsDiv");}else{CheckoutHelperJS.hideDiv("ServiceOptionsDiv");}},showDiv:function(divName){var theDiv=document.getElementById(divName);theDiv.style.visibility="visible";theDiv.style.display="block";},hideDiv:function(divName){var theDiv=document.getElementById(divName);theDiv.style.visibility="hidden";theDiv.style.display="none";},WHRaddGiftWrap:function(checkBoxName,giftWrapId,orderItemId,region,currentffmCenterId,currentIndex,currentSKUs,keyPressCountValue){thisCheckBoxName=checkBoxName;var thisCheckBox=dojo.byId(thisCheckBoxName);if(thisCheckBox.checked){setTimeout(dojo.hitch(this,"updateWHRServiceOptions",giftWrapId,region,currentffmCenterId,orderItemId,currentIndex,1,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);}else{giftWrapId="";setTimeout(dojo.hitch(this,"updateWHRServiceOptions",giftWrapId,region,currentffmCenterId,orderItemId,currentIndex,1,currentSKUs,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);}},displayGiftMsg:function(){var itemsChecked=0;$("#page.shoppingCartPage #order_details div #giftWrap input.checkbox").each(function(){if($(this).attr("checked")){itemsChecked++;}});if(itemsChecked>0){if($("#page.shoppingCartPage #box #MS_giftMessageDiv").css("display")=="none"){$("#page.shoppingCartPage #box #MS_giftMessageDiv").css("display","inline");}}else{$("#page.shoppingCartPage #box #MS_giftMessageDiv").css("display","none");}},WHRreturnZipCodeFromCookie:function(zipID){var zipCode="";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){zipCode=zipRegCookie.split("|")[0];zipCode=zipCode.split("%")[0];}dojo.byId(zipID).value=zipCode;},WHRlimitTextLength:function(textAreaName,countFieldName){var textArea=dojo.byId(textAreaName);var textLength=textArea.value.length;var countField=dojo.byId(countFieldName);if(countFieldName!=null){countField.value=this.giftMessageMaxLength-textArea.value.length;}},updateCartWaitFrequency:function(freqBox,statcount,orderItemId,event){if(event.keyCode==dojo.keys.TAB){return;}if(!this.isAjaxCheckOut()){return;}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0;}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateCartFrequency",freqBox,statcount,orderItemId,this.keyPressCount[orderItemId]),this.updateWaitTimeOut);},updateCartFrequency:function(freqBox,statusCount,orderItemId,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return;}var frequency=(freqBox.value);var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"frequency",frequency,false,-1);params.frequency=frequency;params.invCheck="false";var zipRegCookie=dojo.cookie("WHR_zipreg");if(zipRegCookie!=null&&zipRegCookie!=""){var zipCdRegionArr=zipRegCookie.split("|");params.zipCode=zipCdRegionArr[0];}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);},changeDelDateWithFreq:function(frequency,nxtShipDate){var freq=document.getElementById(frequency).value;var nextShip=new Date(nxtShipDate);var byMonths=0;if(freq==1){byMonths=1;}if(freq==2){byMonths=2;}if(freq==3){byMonths=3;}if(freq==6){byMonths=6;}if(freq==9){byMonths=9;}nextShip.setMonth(nextShip.getMonth()+byMonths);var dateObj=dijit.byId("MS_requestedShippingDate_1");dateObj.attr("value",nextShip);},preSelectTopMandatoryService:function(orderItemsArr){var orderItemsArray=[];orderItemsArray=orderItemsArr.slice(1).split("_");var isTopServiceChecked=false;if(orderItemsArray.length>0){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";for(var i=0;i<orderItemsArray.length;i++){var checkedService=$("input[type=radio][name=MandatoryServiceOptions_"+orderItemsArray[i]+"]:checked").val();if(checkedService==undefined){var serviceEl=$("input[type=radio][name=MandatoryServiceOptions_"+orderItemsArray[i]+"]").filter(":first");var serviceId=serviceEl.val();serviceEl.attr("checked","checked");this.updateParamObject(params,"orderItemId",orderItemsArray[i],false,-1);this.updateParamObject(params,"comment","_"+serviceId+"_",false,-1);isTopServiceChecked=true;}}if(isTopServiceChecked){cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params);}}},cardinalCheckout:function(orderId,flowType,paymentType){MessageHelper.hideAndClearMessage();var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=orderId;params.flowType=flowType;params.paymentType=paymentType;var form=document.forms.frmCardinalLaunch;var termUrl=form.TermUrl.value;termUrl=termUrl+"&paymentType="+paymentType;form.TermUrl.value=termUrl;if(!submitRequest()){return;}cursor_wait();wc.service.invoke("AjaxCardinalCheckout",params);}};var currentAngleImgId="productAngleImg0";var currentTabId="Description";function changeThumbNail(angleImgId,imgsrc){if(currentAngleImgId!=""){document.getElementById(currentAngleImgId).className="off";}currentAngleImgId=angleImgId;document.getElementById(angleImgId).className="on";document.getElementById("productMainImage").src=imgsrc;}function setOff(id){document.getElementById(id+"_On").style.display="none";document.getElementById(id+"_Off").style.display="inline";}function setOn(id){document.getElementById(id+"_On").style.display="inline";document.getElementById(id+"_Off").style.display="none";}function selectTab(tabId){setOff(currentTabId);setOn(tabId);currentTabId=tabId;dijit.byId("mainTabContainer").selectChild(dijit.byId(tabId));}dojo.require("wc.service.common");dojo.require("dojox.collections.ArrayList");EndecaHelperJS={langId:"-1",storeId:"",catalogId:"",drillDownCount:"0",drillDownHash:new Object(),drillDownHashKeys:[],drillDownSeparatorImgPath:"",searchConstraint:"",ajaxRefreshURL:"",ajaxRefreshURL_DivId:"",sortValue:"",refinementValue:"",navType:"",breadcrumbCount:"0",breadcrumbHash:new Object(),breadcrumbHashKeys:[],pageSize:"",minPrice:"",maxPrice:"",origMinPrice:"",origMaxPrice:"",allResultsLabel:"",refineResultsLabel:"",pageTitle:"",storeCountry:"",absStoresWebPath:"",beginIndex:"0",selectedTab:"",pageView:"",isRefreshRequired:false,isZipcodeChangedOnPage:false,setCommonParameters:function(langId,storeId,catalogId){this.langId=langId;this.storeId=storeId;this.catalogId=catalogId;},setIsRefreshRequired:function(isRefreshRequired){this.isRefreshRequired=isRefreshRequired;},setNavType:function(navType){this.navType=navType;},setPageSize:function(newPageSize){this.pageSize=newPageSize;},setAjaxRefreshURLDivID:function(urlRefreshDivID){this.ajaxRefreshURL_DivId=urlRefreshDivID;},getAjaxRefreshURL:function(){if(this.ajaxRefreshURL_DivId!=null&&document.getElementById(this.ajaxRefreshURL_DivId)!=null){this.ajaxRefreshURL=document.getElementById(this.ajaxRefreshURL_DivId).firstChild.data;}return this.ajaxRefreshURL;},setSearchConstraint:function(constraint){this.searchConstraint=constraint;},setSortById:function(sortById){this.sortValue=sortById;},getSortById:function(){if(this.sortValue==null||this.sortValue.length==0){this.sortValue=document.getElementById("sortById").firstChild.data;}return this.sortValue;},setRefinementValue:function(refinementValue){this.refinementValue=refinementValue;},setIsZipcodeChangedOnPage:function(zipcodeChangedOnPage){this.isZipcodeChangedOnPage=zipcodeChangedOnPage;},refreshProductsBySort:function(newSort){this.sortValue=newSort.options[newSort.selectedIndex].value;var newURL=this.getAjaxRefreshURL()+"&SRC_sortById="+this.sortValue+"&SRC_searchConstraint="+this.refinementValue+"&pageSize="+this.pageSize+"&beginIndex=0&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice;console.debug("New URL being rendered for sorting= "+newURL);setCurrentId(newSort.id);this.refreshProductsByFilterURL("searchUpdate",newURL);},refreshProductsByPageSize:function(newPageSize){this.pageSize=newPageSize.options[newPageSize.selectedIndex].value;var newURL=this.getAjaxRefreshURL()+"&SRC_sortById="+this.sortValue+"&SRC_searchConstraint="+this.refinementValue+"&pageSize="+this.pageSize+"&beginIndex=0&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice;console.debug("New URL being rendered for page size= "+newURL);setCurrentId(newPageSize.id);this.refreshProductsByFilterURL("searchUpdate",newURL);},refreshProductsByFilterURL:function(workAreaModeValue,changeUrl){window.location="#back";$.cookie("BackButton_url",changeUrl,{path:""});$.cookie("BackButton_beginIndex",this.beginIndex,{path:""});$.cookie("BackButton_sortValue",this.sortValue,{path:""});$.cookie("BackButton_pageSize",this.pageSize,{path:""});$.cookie("BackButton_refinementValue",this.refinementValue,{path:""});$.cookie("BackButton_minPrice",this.minPrice,{path:""});$.cookie("BackButton_maxPrice",this.maxPrice,{path:""});if(!submitRequest()){return false;}cursor_wait();if(this.navType=="browse"){CommonControllersDeclarationJS.setControllerURL("CategoryDisplay_Controller",changeUrl);wc.render.updateContext("CategoryDisplay_Context");}else{if(this.navType=="filterFinder"){CommonControllersDeclarationJS.setControllerURL("WaterFilterResultDisplay_Controller",changeUrl);wc.render.updateContext("WaterFilterResultDisplay_Context");}else{CommonControllersDeclarationJS.setControllerURL("catalogSearchResultDisplay_Controller",changeUrl);wc.render.updateContext("catalogSearchResultDisplay_Context");}}return true;},setDrillDownSeparatorImgPath:function(imagePath){this.drillDownSeparatorImgPath=imagePath;},appendDrillDownOption:function(drillDownFeature,drillDownOptionLabel,drillDownOptionCount,drillDownOptionState,drillDownMultiselect){var drillDown=this.drillDownHash[drillDownFeature];var drillDownOption=new Object();drillDownOption.aLabel=drillDownOptionLabel;drillDownOption.aCount=drillDownOptionCount;drillDownOption.aState=drillDownOptionState;drillDownOption.isMultiselect=drillDownMultiselect;if(drillDown==null){var newArray=new Array();newArray[0]=drillDownOption;this.drillDownHash[drillDownFeature]=newArray;this.drillDownHashKeys[this.drillDownCount++]=drillDownFeature;}else{drillDown[drillDown.length]=drillDownOption;}},appendBreadcrumb:function(facetName,breadcrumbLabel,removeValue,removeAllValue){var breadcrumb=this.breadcrumbHash[facetName];var breadcrumbOption=new Object();breadcrumbOption.label=breadcrumbLabel;breadcrumbOption.removeValue=removeValue;breadcrumbOption.removeAllValue=removeAllValue;if(breadcrumb==null){var newArray=new Array();newArray[0]=breadcrumbOption;this.breadcrumbHash[facetName]=newArray;this.breadcrumbHashKeys[this.breadcrumbCount++]=facetName;}else{breadcrumb[breadcrumb.length]=breadcrumbOption;}},appendBreadcrumbAncestor:function(facetName,breadcrumbLabel,selectValue){var breadcrumb=this.breadcrumbHash[facetName];var breadcrumbOption=breadcrumb[0];var ancestorArray=breadcrumbOption.ancestors;if(!ancestorArray){ancestorArray=new Array();breadcrumbOption.ancestors=ancestorArray;}var ancestor=new Object();ancestor.label=breadcrumbLabel;ancestor.select=selectValue;ancestorArray[ancestorArray.length]=ancestor;},createRefinementHeading:function(refinementName){var newLabelText=document.createTextNode(this.escapeXML(refinementName));var newElem=document.createElement("dt");newElem.setAttribute("class","filter-title");newElem.setAttribute("className","filter-title");newElem.appendChild(newLabelText);return newElem;},createLeftBreadcrumb:function(breadcrumb){var newDd=document.createElement("dd");newDd.setAttribute("class","filter-item");newDd.setAttribute("className","filter-item");var breadcrumbText="";var removeValue="";if(breadcrumb.ancestors&&breadcrumb.ancestors.length){var ancestorsSize=breadcrumb.ancestors.length;for(var i=0;i<ancestorsSize;i++){breadcrumbText+=breadcrumb.ancestors[i].label+" > ";removeValue=breadcrumb.ancestors[i].select;}}breadcrumbText+=breadcrumb.label;if(removeValue.length==0){removeValue=breadcrumb.removeValue;}newDd.setAttribute("id","filter-item-"+removeValue);var newAnchor=document.createElement("a");newAnchor.setAttribute("class","filter-selected");newAnchor.setAttribute("className","filter-selected");newAnchor.setAttribute("href","javascript:setCurrentId('filter-item-"+removeValue+"');EndecaHelperJS.refreshProductsByFilter('"+removeValue+"');");newAnchor.innerHTML=breadcrumbText;newDd.appendChild(newAnchor);return newDd;},createAllResultsBreadcrumb:function(breadcrumbLabel){var newDd=document.createElement("dd");newDd.setAttribute("class","filter-item");newDd.setAttribute("className","filter-item");newDd.setAttribute("id","filter-item-allresults");var newAnchor=document.createElement("a");newAnchor.setAttribute("class","filter-selected");newAnchor.setAttribute("className","filter-selected");newAnchor.setAttribute("href","javascript:setCurrentId('filter-item-allresults');EndecaHelperJS.refreshProductsByFilter('0');");newAnchor.innerHTML=breadcrumbLabel;newDd.appendChild(newAnchor);return newDd;},createRefinementOption:function(optionName,cnt,elementId){var newDd=document.createElement("dd");newDd.setAttribute("class","filter-item");newDd.setAttribute("className","filter-item");newDd.setAttribute("id","filter-item-"+elementId);var newAnchor=document.createElement("a");newAnchor.setAttribute("class","filter-link");newAnchor.setAttribute("className","filter-link");newAnchor.setAttribute("href","javascript:setCurrentId('filter-item-"+elementId+"');EndecaHelperJS.refreshProductsByFilter('"+elementId+"');");newAnchor.innerHTML=optionName+" ("+cnt+")";newDd.appendChild(newAnchor);return newDd;},createAllResultsOption:function(label){var newDd=document.createElement("dd");newDd.setAttribute("class","filter-item");newDd.setAttribute("className","filter-item");newDd.setAttribute("id","filter-item-allresults");var newAnchor=document.createElement("a");newAnchor.setAttribute("class","filter-link");newAnchor.setAttribute("className","filter-link");newAnchor.setAttribute("href","javascript:setCurrentId('filter-item-allresults');EndecaHelperJS.refreshProductsByFilter('0');");newAnchor.innerHTML=label;newDd.appendChild(newAnchor);return newDd;},refreshProductsByFilter:function(refineValue){var newURL;this.refinementValue=refineValue;if(this.getAjaxRefreshURL()!=null){newURL=this.getAjaxRefreshURL();var start=newURL.indexOf("SRC_searchConstraint=");if(start>-1){var end=newURL.indexOf("&",start);if(end==-1){oldFilter=newURL.substring(start);}else{oldFilter=newURL.substring(start,end);}newURL=newURL.replace(oldFilter,"SRC_searchConstraint="+refineValue);}else{newURL=newURL+"&SRC_searchConstraint="+refineValue;}newURL=newURL+"&beginIndex=0&SRC_sortById="+this.sortValue+"&pageSize="+this.pageSize+"&selectedTab="+this.selectedTab+"&pageView="+this.pageView;if(this.minPrice!=this.origMinPrice||this.maxPrice!=this.origMaxPrice){newURL=newURL+"&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice;}console.debug("New URL being rendered for filtering= "+newURL);this.refreshProductsByFilterURL("searchUpdate",newURL);}},removeAllFilters:function(categoryRefineValue){this.minPrice="";this.maxPrice="";this.refreshProductsByFilter(categoryRefineValue);},updateDrilldownOptionsWithBreadcrumbs:function(){this.drillDownHash=new Object();this.drillDownCount="0";this.drillDownHashKeys=[];if(document.getElementById("drillOptionsArray")!=null){var newOptionsJSON=eval("("+document.getElementById("drillOptionsArray").innerHTML+")");var index=0;for(x in newOptionsJSON){var refinementLabel=newOptionsJSON[x].refinementLabel;var refinementOptionLabel=newOptionsJSON[x].refinementOptionLabel;var option_id=newOptionsJSON[x].internalStateId;var count=newOptionsJSON[x].count;var isMultiselect=newOptionsJSON[x].isMultiselect;this.appendDrillDownOption(refinementLabel,refinementOptionLabel,count,option_id,isMultiselect);}}this.breadcrumbHash=new Object();this.breadcrumbCount="0";this.breadcrumbHashKeys=[];if(document.getElementById("breadcrumbArray")!=null){var newOptionsJSON=eval("("+document.getElementById("breadcrumbArray").innerHTML+")");var index=0;for(x in newOptionsJSON){var refinementLabel=newOptionsJSON[x].facetName;var refinementOptionLabel=newOptionsJSON[x].breadcrumbLabel;var removeValue=newOptionsJSON[x].remove;var removeAllValue=newOptionsJSON[x].removeAll;this.appendBreadcrumb(refinementLabel,refinementOptionLabel,removeValue,removeAllValue);for(y in newOptionsJSON[x].ancestors){this.appendBreadcrumbAncestor(refinementLabel,newOptionsJSON[x].ancestors[y].label,newOptionsJSON[x].ancestors[y].select);}}}this.drawDrillDownOptionsWithBreadcrumbs("drilldownArea");configEndecaFilter();},drawDrillDownOptionsWithBreadcrumbs:function(locationDivID){if(!document.getElementById(locationDivID)){return;}var newDiv=document.createElement("div");newDiv.setAttribute("id","endeca-filters");newDiv.setAttribute("class","endeca-filters");newDiv.setAttribute("className","endeca-filters");var oldDiv=document.getElementById("endeca-filters");if(!oldDiv){document.getElementById(locationDivID).appendChild(newDiv);}else{document.getElementById(locationDivID).replaceChild(newDiv,oldDiv);}var newList=document.createElement("dl");newList.setAttribute("class","endeca-filter");newList.setAttribute("className","endeca-filter");var keySize=this.breadcrumbHashKeys.length;var numListItems=0;for(var i=0;i<keySize;i++){var values=this.drillDownHash[this.breadcrumbHashKeys[i]];if(values==null){var newHeading=this.createRefinementHeading(this.breadcrumbHashKeys[i]);newList.appendChild(newHeading);var bcValues=this.breadcrumbHash[this.breadcrumbHashKeys[i]];if(bcValues!=null){for(var x=0;x<bcValues.length;x++){var newBreadcrumb=this.createLeftBreadcrumb(bcValues[x]);newList.appendChild(newBreadcrumb);numListItems++;}}if(this.allResultsLabel!=null&&this.allResultsLabel.length>0&&this.breadcrumbHashKeys[i]==this.refineResultsLabel&&this.pageTitle.length==0){var newRefinementOption=this.createAllResultsOption(this.allResultsLabel);newList.appendChild(newRefinementOption);}}}keySize=this.drillDownHashKeys.length;for(var i=0;i<keySize;i++){var newHeading=this.createRefinementHeading(this.drillDownHashKeys[i]);newList.appendChild(newHeading);var values=this.breadcrumbHash[this.drillDownHashKeys[i]];if(values!=null){for(var x=0;x<values.length;x++){var newBreadcrumb=this.createLeftBreadcrumb(values[x]);newList.appendChild(newBreadcrumb);numListItems++;}if(this.allResultsLabel!=null&&this.allResultsLabel.length>0&&this.drillDownHashKeys[i]==this.refineResultsLabel){var newRefinementOption=this.createAllResultsOption(this.allResultsLabel);newList.appendChild(newRefinementOption);}}else{if(this.allResultsLabel!=null&&this.allResultsLabel.length>0&&this.drillDownHashKeys[i]==this.refineResultsLabel){var newBreadcrumb=this.createAllResultsBreadcrumb(this.allResultsLabel);newList.appendChild(newBreadcrumb);}}values=this.drillDownHash[this.drillDownHashKeys[i]];for(var x=0;x<values.length;x++){if(values[x].aCount>0){var newRefinementOption=this.createRefinementOption(values[x].aLabel,values[x].aCount,values[x].aState);newList.appendChild(newRefinementOption);numListItems++;}}}if(numListItems>0){newDiv.appendChild(newList);}var eraseAllDiv=document.getElementById("erase_link");if(eraseAllDiv!=null){if(this.breadcrumbCount!="0"||this.minPrice!=""){eraseAllDiv.style.cssText="display:block;";}else{eraseAllDiv.style.cssText="display:none;";}}},setAllResultsLabel:function(label){this.allResultsLabel=label;},setRefineResultsLabel:function(label){this.refineResultsLabel=label;},setPageTitle:function(title){this.pageTitle=title;},submitCompare:function(compareUrl){if(getCookie(cookieItemProducts)){var compareItems=getCookie(cookieItemProducts).split("|");for(i=0;i<compareItems.length;i++){if(compareItems[i].length>0){var itemAttrs=compareItems[i].split(",");compareUrl+="&catentryId="+itemAttrs[0];}}}window.location=compareUrl;},setActiveFilterCookie:function(cookieName){var currentFilter=this.refinementValue;var index=currentFilter.indexOf("+");while(index!=-1){currentFilter=currentFilter.replace("+","~");index=currentFilter.indexOf("+");}if(currentFilter.indexOf("~")>-1){dojo.cookie(cookieName,currentFilter,{path:"/"});}},refreshProductsByPriceRange:function(newMinPrice,newMaxPrice){newMinPrice=newMinPrice*100;newMaxPrice=newMaxPrice*100;this.minPrice=newMinPrice;this.maxPrice=newMaxPrice;var newURL=this.getAjaxRefreshURL()+"&SRC_sortById="+this.sortValue+"&SRC_searchConstraint="+this.refinementValue+"&pageSize="+this.pageSize+"&beginIndex=0&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice+"&selectedTab="+this.selectedTab+"&pageView="+this.pageView;console.debug("New URL being rendered for price range= "+newURL);setCurrentId("priceRangeDiv");this.refreshProductsByFilterURL("searchUpdate",newURL);},initPriceSlider:function(){if(document.getElementById("priceSliderVars")&&document.getElementById("slider")){var priceRangeJSON=eval("("+document.getElementById("priceSliderVars").innerHTML+")");this.origMinPrice=priceRangeJSON.rangeMin;this.origMaxPrice=priceRangeJSON.rangeMax;showHide("#priceRangeDiv","");priceSlider(this.origMinPrice,this.origMaxPrice);$(".ui-slider").css("background-image").replace(/([^.]*)\.(.*)/,"$1_over.$2");}},updatePriceSlider:function(){if(document.getElementById("priceSliderVars")&&document.getElementById("slider")){var priceRangeJSON=eval("("+document.getElementById("priceSliderVars").innerHTML+")");showHide("#priceRangeDiv","");var min=priceRangeJSON.rangeMin;var max=priceRangeJSON.rangeMax;if(this.minPrice!=""){min=this.minPrice/100;}if(this.maxPrice!=""){max=this.maxPrice/100;}priceSlider(min,max,this.origMinPrice,this.origMaxPrice);$(".ui-slider").css("background-image").replace(/([^.]*)\.(.*)/,"$1_over.$2");}},refreshPriceSlider:function(){if(EndecaHelperJS.isZipcodeChangedOnPage){this.setIsZipcodeChangedOnPage(false);if(document.getElementById("priceSliderVars")&&document.getElementById("slider")){if(document.getElementById("amountAct")){showHide("#priceRangeDiv","");}else{this.updatePriceSlider();}}else{showHide("","#priceRangeDiv");}}},setStoreCountry:function(storeCountry){this.storeCountry=storeCountry;},setAbsStoresWebPath:function(absStoresWebPath){this.absStoresWebPath=absStoresWebPath;},refreshProductsForLocation:function(){var newURL=this.getAjaxRefreshURL();if(newURL!=""){setCurrentId("zipcodeTxt");this.refreshProductsByFilterURL("searchUpdate",newURL);}},popup_refreshProductsForLocation:function(){var newURL=this.getAjaxRefreshURL();if(newURL!=""){setCurrentId("popup_zipcodeTxt");this.refreshProductsByFilterURL("searchUpdate",newURL);}},getPlantCodeByZip:function(isPopup){var fieldPrefix=isPopup?"popup_":"";var zipCode=$("#"+fieldPrefix+"zipcodeTxt").val();document.getElementById(fieldPrefix+"zipcodeTxt").style.background="#ffffff";var hasLeftSidebarZipField=$("#main_content_wrapper #left_nav_container .cl-zip-code-search").length>0;wc.service.declare({id:"getPlantCodeByZip",actionId:"getPlantCodeByZip",url:this.absStoresWebPath+"/AjaxGetPlantCodeByZip",formId:"",successHandler:function(serviceResponse){var plantCode=serviceResponse.plantCode;setValueToCookie("WHR_zipreg",zipCode+"|"+plantCode);cursor_clear();if(isPopup){dijit.byId("zip_code_popup").onZipCodeSelected(zipCode);dijit.byId("zip_code_popup").hide();if(hasLeftSidebarZipField){$("#main_content_wrapper #left_nav_container .cl-zip-code-search #zipcodeTxt").val(zipCode);}if(EndecaHelperJS.isRefreshRequired){EndecaHelperJS.popup_refreshProductsForLocation();EndecaHelperJS.setIsZipcodeChangedOnPage(true);}}else{EndecaHelperJS.refreshProductsForLocation();EndecaHelperJS.setIsZipcodeChangedOnPage(true);}},failureHandler:function(serviceResponse){clearValueFromCookie("WHR_zipreg");cursor_clear();document.getElementById(fieldPrefix+"zipcodeTxt").focus();if(serviceResponse.errorCode=="5140"){MessageHelper.formErrorHandleClient(fieldPrefix+"zipcodeBtn",MessageHelper.messages.ERROR_InvalidJurisdisctionCode);document.getElementById(fieldPrefix+"zipcodeTxt").style.background="#ff0000";}else{if(serviceResponse.errorCode==""||serviceResponse.errorCode==null){MessageHelper.formErrorHandleClient(fieldPrefix+"zipcodeBtn",MessageHelper.messages.ERROR_WebserviceUnavailable_TryLater);}}if(isPopup&&hasLeftSidebarZipField){$("#main_content_wrapper #left_nav_container .cl-zip-code-search #zipcodeTxt").val("");}return false;}});if(!submitRequest()){return;}var params=[];params.langId=langId;params.storeId=storeId;params.catalogId=catalogId;params.country=this.storeCountry;params.zipCode=zipCode.toUpperCase();cursor_wait();wc.service.invoke("getPlantCodeByZip",params);},escapeXML:function(str){str=str.replace(/\&amp;/g,"&");return str;},refreshProductListByFilterURL:function(workAreaModeValue,changeUrl){CommonControllersDeclarationJS.setControllerURL("catalogSearchResultDisplay_Controller",changeUrl);wc.render.updateContext("catalogSearchResultDisplay_Context");return true;},refreshProductsBySortLink:function(newSort){this.sortValue=newSort;var newURL=this.getAjaxRefreshURL()+"&beginIndex=0&SRC_sortById="+this.sortValue+"&SRC_searchConstraint="+this.refinementValue+"&pageSize="+this.pageSize+"&selectedTab="+this.selectedTab+"&pageView="+this.pageView;if(this.minPrice!=this.origMinPrice||this.maxPrice!=this.origMaxPrice){newURL=newURL+"&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice;}console.debug("New URL being rendered for sorting= "+newURL);this.refreshProductsByFilterURL(this.navType,newURL);},refreshProductsByPageSizeLink:function(newPageSize){this.pageSize=newPageSize;var newURL=this.getAjaxRefreshURL()+"&beginIndex=0&SRC_sortById="+this.sortValue+"&SRC_searchConstraint="+this.refinementValue+"&pageSize="+this.pageSize+"&selectedTab="+this.selectedTab+"&pageView="+this.pageView;if(this.minPrice!=this.origMinPrice||this.maxPrice!=this.origMaxPrice){newURL=newURL+"&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice;}console.debug("New URL being rendered for page size= "+newURL);this.refreshProductsByFilterURL(this.navType,newURL);},refreshResultByPage:function(newBeginIndex){this.beginIndex=newBeginIndex;var newURL=this.getAjaxRefreshURL()+"&SRC_sortById="+this.sortValue+"&SRC_searchConstraint="+this.refinementValue+"&pageSize="+this.pageSize+"&beginIndex="+this.beginIndex+"&selectedTab="+this.selectedTab+"&pageView="+this.pageView;if(this.minPrice!=this.origMinPrice||this.maxPrice!=this.origMaxPrice){newURL=newURL+"&SRC_minPrice="+this.minPrice+"&SRC_maxPrice="+this.maxPrice;}console.debug("New URL being rendered for pagination= "+newURL);this.refreshProductsByFilterURL(this.navType,newURL);},refreshGlobalSearchResult:function(cbInfo,refineValue){var changeURL;var refinementList=document.getElementById("ajaxGlobalRefinements").firstChild.data;if(refinementList=="0+"){refinementList="";}var ajaxSearchResultURL=document.getElementById("ajaxGlobalSearchRefreshURL").firstChild.data;if(cbInfo.checked==true){refinementList+=refineValue+"+";}else{if(refinementList.indexOf(refineValue)>-1){var tempText=refinementList.replace(refineValue+"+","");refinementList=tempText;}}document.getElementById("ajaxGlobalRefinements").firstChild.data=refinementList;var ajaxRefinementList=refinementList.substring(0,refinementList.lastIndexOf("+"));changeURL=ajaxSearchResultURL+"&SRC_searchConstraint="+ajaxRefinementList;this.refinementValue=ajaxRefinementList;if(ajaxRefinementList!=""){this.refreshProductsByFilterURL("searchUpdate",changeURL);if($("div#product_listings:visible").length==0){$("#product_listings").slideDown("slow",function(){});}}else{$("#product_listings").slideUp("slow",function(){});}},setSelectedTab:function(selectedTab){this.selectedTab=selectedTab;},setPageView:function(pageView){this.pageView=pageView;},removePriceRange:function(){this.minPrice="";this.maxPrice="";this.refreshProductsByFilter(this.refinementValue);},printPreview:function(){var ajaxPrintPreviewURL=document.getElementById("ajaxRefreshPrintPreviewURL").firstChild.data;ajaxPrintPreviewURL=ajaxPrintPreviewURL+"&printPreview=true";window.open(ajaxPrintPreviewURL,"printPreview","width=1100,height=700,left=100,top=100,screenX=0,screenY=100,height=200,toolbar=0,menubar=0,scrollbars=1,resizable=1");}};function configEndecaFilter(){}function refreshSearchPR(prArray){if(prArray!=undefined){var arr=prArray.split(",");for(var i=0;i<arr.length;i++){if(arr[i].length>1){POWERREVIEWS.display.snippet({write:function(content){$(".pr-snippet-"+arr[i]).append(content);}},{pr_page_id:arr[i],pr_snippet_min_reviews:"0"});}}}}$(window).ready(function(){if(window.location.hash=="#back"){EndecaHelperJS.beginIndex=$.cookie("BackButton_beginIndex");EndecaHelperJS.sortValue=$.cookie("BackButton_sortValue");EndecaHelperJS.pageSize=$.cookie("BackButton_pageSize");EndecaHelperJS.refinementValue=$.cookie("BackButton_refinementValue");EndecaHelperJS.minPrice=$.cookie("BackButton_minPrice");EndecaHelperJS.maxPrice=$.cookie("BackButton_maxPrice");if($("#pcSortOptiontop_1").length>0){setCurrentId("pcSortOptiontop_1");displayProgressBar();}EndecaHelperJS.refreshProductsByFilterURL("",$.cookie("BackButton_url"));}refreshSearchPR($("#prPLPArray").val());});